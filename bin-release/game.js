function J(){this.B=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01),a=this.b+this.c+this.e,.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}var W=new function(){this.A=new J;var a,b,c,d,e,f,g,h,i,j,k,l;this.reset=function(){var a=this.A;d=100/(a.f*a.f+.001),e=100/(a.g*a.g+.001),f=1-a.h*a.h*a.h*.01,g=-a.i*a.i*a.i*1e-6,a.a||(k=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(0<a.l?-.9:10),i=0,j=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.D=function(){this.reset();var d=this.A;return a=d.b*d.b*1e5,b=d.c*d.c*1e5,c=d.e*d.e*1e5+12,3*((a+b+c)/3|0)},this.C=function(m,n){var o=this.A,p=1!=o.s||o.v,q=o.v*o.v*.1,r=1+3e-4*o.w,s=o.s*o.s*o.s*.1,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=o.r*o.r*o.r*.2,z=o.q*o.q*(0>o.q?-1020:1020),A=o.p?((1-o.p)*(1-o.p)*2e4|0)+32:0,B=o.d,C=o.j/2,D=o.k*o.k*.01,E=o.a,F=a,G=1/a,H=1/b,I=1/c,o=5/(1+o.u*o.u*20)*(.01+s);o>.8&&(o=.8);for(var J,K,L,M,N,o=1-o,O=!1,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=Array(1024),$=Array(32),_=Z.length;_--;)Z[_]=0;for(_=$.length;_--;)$[_]=2*Math.random()-1;for(_=0;n>_;_++){if(O)return _;if(A&&++X>=A&&(X=0,this.reset()),j&&++i>=j&&(j=0,d*=h),f+=g,d*=f,d>e&&(d=e,w>0&&(O=!0)),K=d,C>0&&(Y+=D,K*=1+Math.sin(Y)*C),K|=0,8>K&&(K=8),E||(k+=l,0>k?k=0:k>.5&&(k=.5)),++Q>F)switch(Q=0,++P){case 1:F=b;break;case 2:F=c}switch(P){case 0:R=Q*G;break;case 1:R=1+2*(1-Q*H)*B;break;case 2:R=1-Q*I;break;case 3:R=0,O=!0}x&&(z+=y,L=0|z,0>L?L=-L:L>1023&&(L=1023)),p&&r&&(q*=r,1e-5>q?q=1e-5:q>.1&&(q=.1)),N=0;for(var ab=8;ab--;){if(V++,V>=K&&(V%=K,3==E))for(J=$.length;J--;)$[J]=2*Math.random()-1;switch(E){case 0:M=k>V/K?.5:-.5;break;case 1:M=1-V/K*2;break;case 2:M=V/K,M=6.28318531*(M>.5?M-1:M),M=1.27323954*M+.405284735*M*M*(0>M?1:-1),M=.225*((0>M?-1:1)*M*M-M)+M;break;case 3:M=$[Math.abs(32*V/K|0)]}p&&(J=U,s*=t,0>s?s=0:s>.1&&(s=.1),u?(T+=(M-U)*s,T*=o):(U=M,T=0),U+=T,S+=U-J,M=S*=1-q),x&&(Z[W%1024]=M,M+=Z[(W-L+1024)%1024],W++),N+=M}N=.125*N*R*v,m[_]=N>=1?32767:-1>=N?-32768:32767*N|0}return n}};window.jsfxr=function(a){W.A.B(a);var b=W.D();a=new Uint8Array(4*((b+1)/2|0)+44);var b=2*W.C(new Uint16Array(a.buffer,44),b),c=new Uint32Array(a.buffer,0,44);c[0]=1179011410,c[1]=b+36,c[2]=1163280727,c[3]=544501094,c[4]=16,c[5]=65537,c[6]=44100,c[7]=88200,c[8]=1048578,c[9]=1635017060,c[10]=b;for(var b=b+44,c=0,d="data:audio/wav;base64,";b>c;c+=3)var e=a[c]<<16|a[c+1]<<8|a[c+2],d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&e]);return d};var aa;!function(){function a(){this.sounds={}}a.prototype.add=function(a,b,c){this.sounds[a]=[],c.forEach(function(c,d){this.sounds[a].push({tick:0,count:b,pool:[]});for(var e=0;b>e;e++){var f=new Audio;f.src=jsfxr(c),this.sounds[a][d].pool.push(f)}},this)},a.prototype.play=function(a){var b=this.sounds[a],c=b.length>1?b[Math.floor(Math.random()*b.length)]:b[0];c.pool[c.tick].play(),c.tick<c.count-1?c.tick++:c.tick=0},aa=new a,aa.add("start",1,[[0,.2,.13,.01,,.3328,,,,,,,,.0994,,,,,1,,,.1,,.5]]),aa.add("right",5,[[3,1,.3197,.7823,.2124,.1117,,.091,,,,,,,,.3901,.1061,-.0873,1,,,,,.5]]),aa.add("pad",1,[[0,,.0945,,.1582,.4416,,-.535,,,,,,.3856,,,,,1,,,.0896,,.5]]),aa.add("boost",1,[[0,,.2833,,.1918,.4914,,.2408,,,,,,.0182,,,,,1,,,,,.5]]),aa.add("ring",1,[[0,,.0177,.565,.2893,.4147,,,,,,.4159,.6958,,,,,,1,,,,,.5]]),aa.add("bumper",1,[[0,,.2389,,.2437,.5057,,.164,,,,,,.1032,,,,,1,,,,,.5]]),aa.add("hurt",1,[[0,,.2056,,.2341,.2899,,.3315,,,,,,.1817,,.6354,,,1,,,,,.5]]),aa.add("eat",1,[[0,,.3402,,.2772,.4978,,.1736,,.2589,.3885,,,.1153,,,,,1,,,,,.5]]),aa.add("die",1,[[3,,.296,.6924,.1761,.2478,,.0895,,,,-.6933,.8848,,,,,,1,,,,,.5]])}(),window.onload=function(){"use strict";function a(){function a(a,f,g,h){var i=4;T(Bb,Zb,Yb,2),Bb.beginPath(),Bb.moveTo(a(-i),f(-i)),Bb.lineTo(a(nb+ob),f(-i)),Bb.lineTo(a(nb+ob),f(nb)),Bb.arcTo(a(nb+ob),f(nb+ob),a(nb),f(nb+ob),ob),Bb.lineTo(a(-i),f(nb+ob)),Bb.closePath(),Bb.fill(),Bb.stroke(),B(C(a(nb),f(nb),ob,ec)),B(D(a(0),f(nb+ob),a(nb),f(nb+ob),ec)),B(D(a(nb+ob),f(0),a(nb+ob),f(nb),ec));var j=a==I?d:e;Bb.font="64px Georgia, serif",Bb.textAlign="center",Bb.textBaseline="middle",T(Bb,ac[g][1]),Bb.fillText(jb(j),a(nb+ob+130)-2,f(50)-3),T(Bb,ac[h][1]),j=f==I?b:c,Bb.fillText(jb(j),a(50)-2,f(nb+ob+130)-3),Bb.font="16px Georgia, serif",Bb.textAlign="center",Bb.textBaseline="middle",T(Bb,ac[g][1]),Bb.fillText(pc[g],a(nb+ob+30),f(12)),T(Bb,ac[h][1]),Bb.fillText(pc[h],a(16),f(nb+ob+12))}U(Tb,0,0,wb,wb,Vb),U(Tb,0,0,wb-1,wb-1,Wb),U(Tb,0,0,wb-2,wb-2,Ub),U(Bb,0,0,ub,ub,Sb),Bb.globalAlpha=.1,U(Bb,0,ub-nb-2,ub,nb,ac[kc][1]),U(Bb,ub-nb-2,0,nb,ub,ac[lc][1]),U(Bb,0,0,ub,nb,ac[mc][1]),U(Bb,0,0,nb,ub,ac[nc][1]),Bb.globalAlpha=1,Bb.globalCompositeOperation="source-over",T(Bb,Ub,Xb,2),X(Bb,0,0,ub,ub),X(Bb,ub,0,0,ub),W(Bb,vb,vb,8,kb,kb);var b=8679,c=8681,d=8678,e=8680;a(I,I,2,3),a(I,J,0,3),a(J,I,2,1),a(J,J,0,1)}function b(){var a=zb,b=a/2;Pb.save(),Pb.translate(4,4),T(Pb,"#aef","#5af",2),Pb.beginPath(),Pb.moveTo(b,0),Pb.quadraticCurveTo(a,-3,a,b),Pb.quadraticCurveTo(a,a+1,b,a-2),Pb.quadraticCurveTo(2,a,0,b),Pb.quadraticCurveTo(-3,-1,b,0),Pb.fill(),Pb.stroke(),T(Pb,lb,"#fff",2),X(Pb,8,4,4,20),X(Pb,16,2,8,26,0,1),X(Pb,36,14,18,36,0,1),X(Pb,38,18,26,36,0,2),T(Pb,lb,"#58f",2),X(Pb,b-4,10,b-4,18),X(Pb,b+4,10,b+4,18),Pb.translate(a+8,0),T(Pb,"#fa0","#f00",2),Pb.beginPath(),Pb.moveTo(b,-4),Pb.lineTo(b+6,14),Pb.lineTo(a-4,8),Pb.quadraticCurveTo(a,a+3,b,a-2),Pb.quadraticCurveTo(2,a,4,8),Pb.lineTo(b-6,14),Pb.lineTo(b,-4),Pb.fill(),Pb.stroke(),X(Pb,b-3,26,b-8,20),X(Pb,b+3,26,b+8,20),Pb.translate(a+8,0),T(Pb,"#fd7","#d72",2),Pb.beginPath(),Pb.moveTo(b,0),Pb.quadraticCurveTo(a,10,a-8,a-8),Pb.quadraticCurveTo(a,a+1,b+2,a-6),Pb.quadraticCurveTo(14,a-12,2,a-4),Pb.quadraticCurveTo(-2,a-10,4,b),Pb.quadraticCurveTo(0,0,b,0),Pb.fill(),Pb.stroke(),T(Pb,"#d72"),W(Pb,10,7,1,kb),W(Pb,24,9,1,kb),W(Pb,7,20,1,kb),W(Pb,20,14,1,kb),W(Pb,8,30,1,kb),W(Pb,28,32,1,kb),T(Pb,"#000","#d72",1);for(var c=0;2>c;c++){var d;0===c?(Pb.globalCompositeOperation="destination-out",d=kb):(Pb.globalCompositeOperation="source-over",d=lb),Pb.scale(1,1.5),W(Pb,13,14,4,d,kb),Pb.scale(1,2/3),Pb.scale(1,1.5),W(Pb,26,14,4,d,kb),Pb.scale(1,2/3)}Pb.translate(a+8,0),Pb.lineCap="round",T(Pb,0,"#fff",2),W(Pb,b,b,b-4,lb,kb),T(0,0,1),Pb.beginPath(),Pb.arc(b,b,b-8,3.2,4.4),Pb.stroke(),W(Pb,b-4,b+4,4,lb,kb),W(Pb,b+4,b+4,4,lb,kb),Pb.restore()}function c(){if(!Qb.width){var a=4;Qb.width=2*(Ic+a)*Jc,Qb.height=2*(Ic+a);for(var b=0;Jc>b;b++){var c=170+b/Jc*68>>0;c=c.toString(16),T(Rb,null,"#"+c+c+"00",3);var d=(2*b+1)*(a+Ic),e=a+Ic;Rb.beginPath(),Rb.arc(d,e,Ic,0,2*gb),Rb.stroke()}}}function d(){Uc=0,zc=0,yc=Date.now(),Rc=0,Pc=!1,xc=Lc,Fc=0,rc=[],sc=[],a(),b(),c(),y()}function e(){if(!Pc&&!Uc)if(hd.right||gd.space)Qc>Rc&&Rc++;else if(Rc>0){var a=.1+.9*Rc/Qc,b=$c+_c*a;ad=b*fb.cos(Tc),bd=b*fb.sin(Tc),cd=Yc+Zc*a,Pc=!0,Ec="start",aa.play("boost")}for(var c=0;c<vc.length;c++){var d,e=vc[c],f=!e.mirror;d=1==e.elt?f?gd.up||gd.right:gd.down||gd.left:f?gd.up||gd.left:gd.down||gd.right;var g=e.ux,h=e.uy;e.cpt=e.cpt||0;var i=9;if(e.max=!1,d?e.cpt<i?e.cpt++:e.max=!0:e.cpt>0&&e.cpt--,e.prevX2=e.x2,e.prevY2=e.y2,e.movingUp=d&&!e.max,e.moving=0!==e.cpt,e.cpt>0){var j=e.amax*(e.cpt/i);e.mirror&&(j*=-1);var k=fb.cos(j),l=fb.sin(j);g=e.ux*k-e.uy*l,h=e.ux*l+e.uy*k}e._ux=g,e._uy=h,e.x2=e.x+g,e.y2=e.y+h}hd.left&&uc.elt!=oc&&0===cd&&Fc>0&&(fd.x=hd.x-uc.x,fd.y=hd.y-uc.y,M(fd,$c+.5*_c),uc.v.x=fd.x,uc.v.y=fd.y,cd=10,ad=uc.v.x,bd=uc.v.y,Ec="click",Fc-=10,hd.left=!1,aa.play("boost")),Fc>0&&Fc--}function f(){var a,b,c;for(b=wc.length,a=0;b>a;a++)c=wc[a],c.a+=c.da,c.x=vb+fb.cos(c.a)*c.d,c.y=vb+fb.sin(c.a)*c.d}function g(){var a,b,c,d,e;for(b=sc.length,a=0;b>a;a++){if(c=sc[a],c.elt!=uc.elt&&uc.elt!=oc){var f=L(uc.x-c.x,uc.y-c.y);200>f&&(c.elt==qc[uc.elt]?(c.tx=c.hx,c.ty=c.hy):(c.tx=uc.x,c.ty=uc.y))}if(d=c.tx-c.x,e=c.ty-c.y,25>d*d+e*e){var g=ib()*gb*2;c.tx=vb+fb.cos(g)*tb,c.ty=vb+fb.sin(g)*tb}else{var h=L(d,e);c.x+=d*Xc/h,c.y+=e*Xc/h}}}function h(){if(Pc){var a,b,c=0,d=0,e=Wc,f=Vc;a=vb-uc.x,b=vb-uc.y;var g=qb/2,h=L(a,b);g>h&&(a/=h,b/=h,e*=.2+.8*h/g,f*=.5+.5*h/g);var i=uc.x-vb,j=uc.y-vb;j>i?j>-i?d=e:c=-e:j>-i?c=e:d=-e,uc.v.x+=c,uc.v.y+=d,cd>0&&(cd--,uc.v.x+=ad,uc.v.y+=bd),uc.v.x*uc.v.x+uc.v.y*uc.v.y>f*f&&M(uc.v,f),uc.x+=uc.v.x,uc.y+=uc.v.y,uc.x=fb.round(uc.x),uc.y=fb.round(uc.y)}}function i(){var a,b,c,d;if(Pc){for(uc.collide=!1,d=rc.length,b=d+sc.length,a=0;b>a;a++){c=d>a?rc[a]:sc[a-d];var e=!1;if(c!=uc){c.collide=!1;var f=fd;c.shape==bc?N(uc,c)&&(j(c,f),c.collide&&m(c,f)):c.shape==cc&&(e=c.kind==hc&&c.movingUp,e?l(c,f):O(uc,c,f)&&(k(c,f),c.collide&&m(c,f)))}}uc.prevX=uc.x,uc.prevY=uc.y}}function j(a,b){if(a.kind!=ic||(qc[uc.elt]!=a.elt||a.dead||(a.dead=!0,Fc=dd,zc++,aa.play("eat")),!a.dead)){a.collide=!0,b.x=uc.x-a.x,b.y=uc.y-a.y;var c=L(b.x,b.y);if(a.kind==fc&&uc.elt!=oc&&(Fc+=50,Fc>dd&&(Fc=dd),aa.play("bumper")),a.kind==ic&&a.elt!=uc.elt){if(Dc=Mc,uc.elt=oc,tc.n<tc.length){tc.n++;var d=tc[tc.n-1];d.m=a,d.dx=b.x*(Gc-Ic)/c,d.dy=b.y*(Gc-Ic)/c,Ac=Mc,Bc=-1}aa.play("hurt")}b.l=a.r+uc.r-c,b.x=b.x/c,b.y=b.y/c}}function k(a,b){var c;a.collide=!0,P(ed,a.x,a.y,a.x2,a.y2);var d=Q(ed,uc.x,uc.y)!==Q(ed,uc.prevX,uc.prevY);0>=d?c=uc.r-b.l:(c=uc.r+b.l,b.x*=-1,b.y*=-1),b.x/=b.l,b.y/=b.l,b.l=c}function l(a,b){var c,d,e=O(uc,a,b),f=1==a.elt||3==a.elt;if(e||(P(ed,a.x,a.y,a.prevX2,a.prevY2),c=Q(ed,uc.prevX,uc.prevY,f),P(ed,a.x,a.y,a.x2,a.y2),d=Q(ed,uc.x,uc.y,f)),e||c!==d){var g=uc.x-a.x,h=uc.y-a.y,i=g*a._ux+h*a._uy;if((e||i>0)&&(e||g*g+h*h<a.l*a.l)){a.collide=!0;var j=(L(g,h),i/a.l);b.x=a.x+j*a._ux/a.l,b.y=a.y+j*a._uy/a.l,b.x=uc.x-b.x,b.y=uc.y-b.y,b.l=L(b.x,b.y),b.x/=b.l,b.y/=b.l;var k=a._uy/a.l,l=-a._ux/a.l;(a.mirror&&(0===a.elt||3==a.elt)||!a.mirror&&(1==a.elt||2==a.elt))&&(k*=-1,l*=-1);var m=k*b.x+l*b.y;0>m&&(b.x*=-1,b.y*=-1),b.l=b.l+uc.r,uc.x+=b.x*b.l,uc.y+=b.y*b.l,uc.collide=!0;var n=j/a.l;n=.1+.9*(.3*n+.7*n*n);var o=Yc+n*Zc>>0,p=$c+_c*n,q=b.x*p,r=b.y*p;cd&&Ec==hc?(cd=o,ad=.2*q+ad,bd=.2*r+bd):(aa.play("pad"),cd=o,ad=q,bd=r),Ec=hc,Fc=dd,ad*=.8+.4*ib(),bd*=.8+.4*ib(),uc.elt=a.elt}}}function m(a,b){cd=0,uc.collide=!0,a.colCpt=20,uc.x+=b.x*b.l,uc.y+=b.y*b.l;var c=L(uc.v.x,uc.v.y),d=uc.v.x/c,e=uc.v.y/c,f=-b.y,g=b.x,h=f*d+g*e;0>h&&(f=-f,g=-g);var i=d*b.x+e*b.y;0>i&&(i=-i);var j=fb.sin(fb.acos(i));0>j&&(j=-j);var k=.2;a.kind==fc?k=1.1:a.kind==ic&&(k=1.1),b.x*=i*k*c,b.y*=i*k*c,f*=j*c,g*=j*c,uc.v.x=b.x+f,uc.v.y=b.y+g}function n(){for(var a,b=(Hc+Ic)*(Hc+Ic),c=2*b,d=(Hc-Gc)*(Hc-Gc),e=sc.length,f=0;f<tc.n;f++){a=tc[f];var g=a.x-uc.x,h=a.y-uc.y,i=g*g+h*h;if(b>i)aa.play("ring"),a.m=null,tc[f]=tc[tc.n-1],tc[tc.n-1]=a,f--,tc.n--,Ac=Mc,Bc=1,0===tc.n&&(Nc=!0);else if(c>i&&(a.x=a.x-.3*g,a.y=a.y-.3*h),a.m)a.m.dead?a.m=null:(a.x=a.m.x+a.dx,a.y=a.m.y+a.dy);else for(var j=0;e>j;j++){var k=sc[j];g=a.x-k.x,h=a.y-k.y,i=g*g+h*h,d>i&&(a.m=k,a.dx=g,a.dy=h)}}}function o(){f(),g(),h(),i(),n()}function p(){Gb=Eb,Hb=Fb;var a=uc.x,b=uc.y,c=a-vb,d=b-vb,e=c,f=d;0>e&&(e*=-1),0>f&&(f*=-1);var g=mb/2+ob;if(g>e&&g>f){var h=e-g,i=f-g,j=h*h+i*i;if(g*g>j){var k=hb(j);h=h*g/k,i=i*g/k,a=h+g,b=i+g,0>c&&(a=-a),0>d&&(b=-b),a=vb+a,b=vb+b}}else f>e?a=vb:b=vb;a=K(a,uc.x-.3*qb,uc.x+.3*qb),b=K(b,uc.y-.3*rb,uc.y+.3*rb),a=K(a-qb/2,0,ub-qb),b=K(b-rb/2,0,ub-rb),Pc?(Eb+=.1*(a-Eb),Fb+=.1*(b-Fb)):(Eb=a,Fb=b)}function q(){var a=Pc;Y(Db),Y(Lb);a?(V(Db,Ib,0,0),Jb.clearRect(0,0,qb,rb),Jb.save(),Jb.globalAlpha=.9,V(Jb,Cb,-Eb+Gb,-Fb+Hb),Jb.restore(),Y(Db),T(Jb,ac[uc.elt][1]),cd>0?W(Jb,uc.prevX-Eb,uc.prevY-Fb,6,kb):W(Jb,uc.x-Eb,uc.y-Fb,2,kb)):Y(Jb),r(),s(),t(),u(),V(Db,Ab,-Eb,-Fb),a&&V(Db,Ib,0,0),V(Db,Kb,0,0)}function r(){for(var a,b,c=Eb-Ic,d=Eb+qb+Ic,e=Fb-Ic,f=Fb+qb+Ic,g=Qb.width/Jc,h=g/2,i=0,j=tc.n;j>i;i++){var k=tc[i];if(k.cpt+=k.cptDir,k.cpt>=Kc?(k.cpt=Kc,k.cptDir=-1):k.cpt<=0&&(k.cpt=0,k.cptDir=1),a=k.x,b=k.y,a>c&&d>a&&b>e&&f>b){var l=k.cpt/Kc*(Jc-1)>>0;Lb.drawImage(Qb,l*g,0,g,g,a-h-Eb,b-h-Fb,g,g)}}}function s(){for(var a=zb+2*yb,b=0,c=sc.length;c>b;b++){var d=sc[b],e=1;d.dead?(d.cpt-=10,d.cpt<=0?z(d):e=d.cpt/50):d.cpt<50&&(d.cpt++,e=d.cpt/50),d.colCpt>0&&d.colCpt--;var f=qc[uc.elt]==d.elt,g=uc.elt==d.elt;T(Lb,g?Zb:f?ac[d.elt][0]:_b,g?d.colCpt>0?$b:Yb:_b,2),Lb.globalAlpha=e*(g?.5:f?.2:.4),W(Lb,d.x-Eb,d.y-Fb,d.r,kb),d.elt==nc&&(Lb.globalAlpha=1,Lb.globalCompositeOperation="destination-out",W(Lb,d.x-Eb,d.y-Fb,17,kb),Lb.globalCompositeOperation="source-over"),Lb.globalAlpha=e,f||W(Lb,d.x-Eb,d.y-Fb,d.r,lb,kb),Lb.globalAlpha=e*(g?.4:f?.7:1);var h=0,i=0;f&&(h=3*(fb.random()-.5),i=3*(fb.random()-.5)),g&&(Lb.globalAlpha=.4*e),Lb.drawImage(Ob,d.elt*a,0,a,a,d.x-a/2-Eb+h,d.y-a/2-Fb+i,a,a)}Lb.globalAlpha=1}function t(){for(var a=0,b=rc.length;b>a;a++){var c,d=rc[a],e=d.x-Eb,f=d.y-Fb;d!=uc&&(d.shape==bc&&d.kind==fc?(d.colCpt>0?(d.colCpt--,c=$b):c=Yb,T(Lb,"#000",c,2),W(Lb,e,f,d.r,kb,kb)):d.shape==cc&&d.kind!=ec&&(c=Yb,d.kind==hc&&(c=ac[d.elt][1]),T(Lb,0,c,2),X(Lb,d.x-Eb,d.y-Fb,d.x2-Eb,d.y2-Fb)))}}function u(){if(!Uc){var a;Pc?(a=fb.atan2(uc.v.y,uc.v.x),Sc=0):(a=uc.sa,Sc+=.05),uc.cpt=++uc.cpt%20;var b=uc.cpt;b>10&&(b=20-b),Pc||(b=2+8*(Rc/Qc),a+=fb.cos(Sc)*gb/3,Tc=a),b*=.3*gb/10;var c=0,d=0;if(Rc>0&&!Pc){var e=4*K(Rc/Qc,0,1);c=e*ib(),d=e*ib()}uc.elt!=oc&&Fc>0&&(Lb.save(),Lb.translate(uc.x-Eb+c,uc.y-Fb+d),Lb.rotate(a),T(Lb,"#fff","#000",1),Lb.beginPath(),Lb.arc(-10,0,20,0,2.2),Lb.lineTo(0,0),Lb.arc(-10,0,20,-0,-2.2,!0),Lb.lineTo(0,0),Lb.closePath(),Lb.fill(),Lb.stroke(),Lb.globalCompositeOperation="destination-out",W(Lb,0,0,Hc,"#fff"),Lb.restore()),Dc>0?T(Lb,ac[uc.elt][0],_b,3):T(Lb,ac[uc.elt][0],ac[uc.elt][1],2),0===b?W(Lb,uc.x-Eb+c,uc.y-Fb+d,Hc,kb,kb):Z(Lb,uc.x-Eb+c,uc.y-Fb+d,uc.r,a,b,kb,kb)}}function v(){var a=!1;uc.x+Hc<0?(a=!0,uc.x=50,uc.y=vb,uc.sa=0):uc.x-Hc>ub?(a=!0,uc.x=ub-50,uc.y=vb,uc.sa=-gb):uc.y+Hc<0?(a=!0,uc.y=50,uc.x=vb,uc.sa=gb/2):uc.y-Hc>ub&&(a=!0,uc.y=ub-50,uc.x=vb,uc.sa=-gb/2),a&&(Pc=!1,Rc=0,uc.elt=oc,uc.v.x=0,uc.v.y=0,Cc=Mc,Uc=Qc,xc--,0===xc&&(Nc=!0),aa.play("die")),Uc>0&&Uc--}function w(){Y(Nb);var a,b=9,c=14;for(a=0;xc>a;a++)T(Nb,ac[oc][0],"red"),Z(Nb,50+xb/2+a*(b+c),xb/2,b,0,.5,!0);if(Dc>0&&Dc--,Pc&&!Nc){var d=20,e=102,f=(qb-e)/2,g=(xb-d)/2;T(Nb,Wb),U(Nb,f,g,e,d),Dc&&(T(Nb,"#f00"),Nb.globalAlpha=Dc/Qc,U(Nb,f-2,g-2,e+4,d+4),Nb.globalAlpha=1),Fc>0&&uc.elt!=oc&&(Nb.font="12px Georgia, serif",Nb.textAlign="center",Nb.textBaseline="bottom",T(Nb,"#aaa"),Nb.fillText("Left click to boost !",f+e/2,g),T(Nb,"#fff"),e=(e-2)*(Fc/dd)>>0,f=(qb-e)/2+1,U(Nb,f,g,e,d),T(Nb,0,Wb,2),Nb.save(),Nb.translate(qb/2,g+10),Nb.rotate(-gb/2),Nb.beginPath(),Nb.arc(-10,0,18,-0,-1.4,!0),Nb.lineTo(0,0),Nb.closePath(),Nb.stroke(),Nb.beginPath(),Nb.arc(-10,0,18,0,1.4),Nb.lineTo(0,0),Nb.closePath(),Nb.stroke(),Nb.restore())}T(Nb,0,"#cc0",3),W(Nb,qb-20,xb/2,8,!1,!0);var h=(Date.now()-yc)/1e3>>0,i=h/60>>0,j=h%60;10>j&&(j="0"+j),h=i+":"+j,T(Nb,"#fff"),Nb.font="18px Georgia, serif",Nb.textAlign="left",Nb.textBaseline="middle",Nb.fillText(h,10,xb/2);var k;(!Pc||Nc)&&(Nb.textAlign="center",k=Nc?"Game over":Uc?"Out...":50>Rc?"Hold right mouse button or space key":"Release to launch !",Nb.fillText(k,qb/2,xb/2));var l=tc.length-tc.n,m=l+" / "+tc.length;if(Ac>0&&(Ac--,Bc>0?(T(Nb,"#0f0"),m=jb(8593)+" "+m):(T(Nb,"#f00"),m=jb(8595)+" "+m)),Nb.textAlign="right",Nb.fillText(m,qb-38,xb/2),Cc>0&&Cc--,Nc){var n=xc>0,o=[],p=0,q=1e4,r=100,s=200,t=1e3,u=0;if(o[p++]=n?{t:"YOU WIN :)",s:32,c:"#0f4"}:{t:"YOU LOSE :(",s:32,c:"#f04"},o[p++]={s:24},n?(u+=q,o[p++]={t1:"Finished game:",t2:q,s:18,c:"#ccc"},u+=t*xc,o[p++]={t1:"Extra balls:",t2:xc+" x "+t,s:18,c:"#ccc"}):(u+=r*l,o[p++]={t1:"Rings:",t2:l+" x "+r,s:18,c:"#ccc"}),u+=zc*s,o[p++]={t1:"Eaten monsters:",t2:zc+" x "+s,s:18,c:"#ccc"},h=(Date.now()-yc)/1e3>>0,h=20*(300-h)*l/tc.length>>0,0>h&&(h=0),u+=h,o[p++]={t1:"Time bonus:",t2:h,s:18,c:"#ccc"},o[p++]={t1:"Score:",t2:u,s:24,c:"#fff"},localStorage){var v=parseInt(localStorage.getItem("pacBallScoreMax"));(!v||u>v)&&localStorage.setItem("pacBallScoreMax",u),v&&(u>v?(o[p++]={s:24},o[p++]={t:"New Record !",s:24,c:"#fff"}):o[p++]={t1:"( Record:",t2:v+" )",s:18,c:"#ccc"})}for(o[p++]={s:48},o[p++]={t:"Press SPACE to restart",s:24,c:"#fff"},o[p++]={s:48},c=10,b=2*c,a=0;p>a;a++)b+=o[a].s+4;o.c="#fff";var w=mb/2-10,x=b;for(Db.save(),Db.translate((qb-w)/2>>0,(rb-x)/2>>0),T(Db,"#000","#fff"),Db.fillRect(0,0,w,x),Db.strokeRect(0,0,w,x),Db.textBaseline="top",a=0;p>a;a++)k=o[a],Db.font=k.s+"px Georgia, serif",Db.fillStyle=k.c,k.t?(Db.textAlign="center",Db.fillText(k.t,w/2,c)):k.t1&&(Db.textAlign="right",Db.fillText(k.t1,w/2-4,c),Db.textAlign="left",Db.fillText(k.t2,w/2+4,c)),Db.translate(0,k.s+c);Db.restore()}}function x(){window.stb&&stb(),Nc?gd.space&&(Nc=!1,d(),gd.space=!1):Oc?bb():(e(),o(),v(),p(),q(),w()),window.ste&&ste(),requestAnimationFrame(x)}function y(){uc=B(C(vb,ub-50,Hc,dc)),uc.v={x:0,y:0},uc.cpt=0,uc.elt=oc,uc.sa=-gb/2,F(D(0,210,140,100,gc)),wc=[];var a,b,c,d=4;for(b=0;d>b;b++){var e=Gc-4,f=2*e+(pb-2*e)*b/d,g=2*ib()*gb;a=C(0,0,e,fc),wc.push(B(a));var h=(.2+.2*ib())*(ib()>.5?-1:1);a.da=h/f,a.a=g,a.d=f}for(b=1;d>b;b++)for(c=0;b>c;c++)a=H(wc[b]),a.a+=2*gb*(c+1)/(b+1),wc.push(B(a));F(D(140,100,290,30,hc)),vc=rc.slice(-8);var i=vc[0],j=L(i.x-i.x2,i.y-i.y2),k=2*-fb.acos((i.x2-i.x)/j);for(b=0;b<vc.length;b++)i=vc[b],i.l=j,i.ux=i.x2-i.x,i.uy=i.y2-i.y,i.amax=k,(1==i.elt||2==i.elt)&&(i.amax*=-1);tc=[],tc.n=0,tc.cpt=0;var l,m,n=6,o=11,p=fb.random()*gb;for(b=1;n>=b;b++)for(c=1;o>=c;c++)m=2*gb*(c/o)+.1*b+p,l=A(bc,jc),l.r=Ic,l.cpt=ib()*Kc>>0,l.cptDir=ib()>.5?1:-1,tc[tc.n]=l,tc.n++,l.x=vb+fb.cos(m)*b*tb/n,l.y=vb+fb.sin(m)*b*tb/n;for(b=0;4>b;b++){var q=A(bc,ic);sc.push(q),q.elt=b,q.r=Gc,q.sy=0===b||1==b?nb:ub-nb,q.sx=0===b||3==b?nb:ub-nb,q.hx=vb+.5*mb*(1==b?1:3==b?-1:0),q.hy=vb+.5*mb*(0===b?1:2==b?-1:0),z(q)}}function z(a){a.tx=a.hx,a.ty=a.hy,a.x=a.sx,a.y=a.sy,a.cpt=0,a.dead=!1,a.da=0,a.a=0,a.d=1}function A(a,b,c,d){return{x:c||0,y:d||0,shape:a,kind:b}}function B(a){return rc.push(a),a}function C(a,b,c,d){var e=A(bc,d,a,b);return e.r=c,e}function D(a,b,c,d,e){var f=A(cc,e,a,b);return f.x2=c,f.y2=d,f}function E(a){for(var b=0;4>b;b++){var c=H(a);G(c,"x","y",b),c.shape==cc&&G(c,"x2","y2",b),B(c),c.elt=b}}function F(a){E(a),a.x=mb-a.x,a.shape==cc&&(a.x2=mb-a.x2),a.mirror=!0,E(a)}function G(a,b,c,d){var e=a[b],f=a[c];if(0===d||2==d)e+=nb+ob,0===d&&(f=ub-f);else{var g=f;f=nb+ob+e,e=g,1==d&&(e=ub-e)}a[b]=e,a[c]=f}function H(a){return JSON.parse(JSON.stringify(a))}function I(a){return a}function J(a){return ub-a}function K(a,b,c){return b>a?b:a>c?c:a}function L(a,b){return hb(a*a+b*b)}function M(a,b){b=(b||1)/L(a.x,a.y),a.x*=b,a.y*=b}function N(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.r+b.r;return e*e>c*c+d*d}function O(a,b,c){var d=a.x,e=a.y,f=a.r,g=b.x,h=b.y,i=b.x2,j=b.y2,k=i-g,l=j-h,m=fb.sqrt(k*k+l*l),n=(i-g)/m,o=(j-h)/m,p=n*(d-g)+o*(e-h),q=p*n+g,r=p*o+h;if((i>g&&q>=g&&i>=q||g>i&&q>=i&&g>=q||g==i&&q==g)&&(j>h&&r>=h&&j>=r||h>j&&r>=j&&h>=r||h==j&&r==h)){var s=r-e,t=q-d,u=hb(t*t+s*s);if(f>=u)return c.ex=q,c.ey=r,c.x=-t,c.y=-s,c.l=u,!0}return!1}function P(a,b,c,d,e){b==d?(a.vert=!0,a.x=b):(a.vert=!1,a.m=(c-e)/(b-d),a.p=c-a.m*b)}function Q(a,b,c,d){return a.vert?b<a.x:d?b>(c-a.p)/a.m:c>a.m*b+a.p}function R(a,b){var c=db.createElement("canvas");return c.width=a,c.height=b,c}function S(a){return a.getContext("2d")}function T(a,b,c,d){b&&(a.fillStyle=b),c&&(a.strokeStyle=c),d&&(a.lineWidth=d)}function U(a,b,c,d,e,f){f&&(f.width&&(f=a.createPattern(f,"repeat")),T(a,f)),a.fillRect(b,c,d,e)}function V(a,b,c,d){a.drawImage(b,c,d)}function W(a,b,c,d,e,f){a.beginPath(),a.arc(b,c,d,0,2*gb,!1),e&&a.fill(),f&&a.stroke()}function X(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.stroke()}function Y(a){a.clearRect(0,0,qb,rb)}function Z(a,b,c,d,e,f,g,h){a.beginPath(),a.arc(b,c,d,e+f,e-f),a.quadraticCurveTo(b-.5*d*fb.cos(e),c-.5*d*fb.sin(e),b+d*fb.cos(e+f),c+d*fb.sin(e+f)),a.closePath(),g&&a.fill(),h&&a.stroke()}function $(a,b){b||(b=window.e);var c=b.keyCode;b.charCode&&!c&&(c=b.charCode),gd[id[c]]=a}function _(a,b){var c,d;"which"in b?(c=3==b.which,d=2==b.which):"button"in b&&(c=2==b.button,d=1==b.button),c?hd.right=a:d?hd.middle=a:hd.left=a,db.onmousemove(b)}function ab(){Oc=!Oc}function bb(){jd++;var a=600,b=600;Y(Db),Y(Nb),Db.save(),U(Db,0,0,ub,ub,Sb),Db.translate(qb/2-a/2,20),U(Db,0,0,a,b,"rgba(0,0,0,0.5)");var c="#b7f1d5",d="#0a7e45";Db.font="96px impact",Db.textAlign="center",Db.textBaseline="top",T(Db,c,d,2),Db.fillText("Peanball",a/2,5),Db.strokeText("Peanball",a/2,5);var e=fb.abs(.5*fb.cos(.05*jd));T(Db,ac[oc][0]),Z(Db,20,b-20,40,0,e,kb,kb);for(var f=Qb.height,g=0;16>g;g++)Db.drawImage(Qb,4*f,0,f,f,68+(10+f)*g,b-30,f,f);Db.font="24px impact",Db.textAlign="right",T(Db,"#fff"),Db.fillText("A game by @Saturnyn",a-128,105),Db.font="24px impact",Db.textAlign="right",T(Db,c),Db.fillText("Goal:",130,170),Db.fillText("Controls:",130,210),Db.fillText("Elements:",130,300),Db.font="22px Georgia, serif",Db.textAlign="left",T(Db,"#fff"),Db.fillText("Catch all the rings as fast as possible",140,174),Db.font="16px Georgia, serif",Db.fillText("• Hold and release SPACE or RIGHT CLICK to launch the ball",140,215),Db.fillText("• Use WASD or ARROW keys to control flippers",140,240),Db.fillText("• Use LEFT CLICK to give a boost (while wings are displayed)",140,265),Db.fillText("• Flippers give the ball an elemental power (water/fire/earth/air)",140,305),Db.fillText("• Those powers allows you to beat elemental monsters",140,330),Db.fillText("    ‣ Fire to beat Ice , Water to beat Fire",140,355),Db.fillText("    ‣ Air to beat Sand , Earth to beat Cristal",140,380),Db.fillText("• Avoid touching other elements",140,405),Db.textAlign="right",T(Db,c),Db.fillText("Mega thanks to Mod, Cédric and @Floriaen for their support !",a,b),Db.font="32px impact",Db.textAlign="center",T(Db,c),Db.fillText("Press SPACE to start the game",a/2,b-130),Db.restore()}var cb=window,db=cb.document,eb=db.body,fb=cb.Math,gb=fb.PI,hb=fb.sqrt,ib=fb.random,jb=String.fromCharCode,kb=!0,lb=!1,mb=680,nb=220,ob=200,pb=ob+mb/2;pb=L(pb,pb)-ob>>0;var qb,rb,sb,tb=(mb/2+L(mb/2,mb/2))/2,ub=mb+2*nb+2*ob,vb=ub/2,wb=20,xb=50,yb=4,zb=40,Ab=R(ub,ub),Bb=S(Ab),Cb=R(),Db=S(Cb);Cb.style.cursor="crosshair";var Eb,Fb,Gb,Hb,Ib=R(),Jb=S(Ib),Kb=R(),Lb=S(Kb),Mb=R(),Nb=S(Mb),Ob=R(4*(zb+2*yb),zb+2*yb),Pb=S(Ob),Qb=R(),Rb=S(Qb),Sb=R(wb,wb),Tb=S(Sb);window.onresize=function(){qb=K(cb.innerWidth,mb,ub),rb=K(cb.innerHeight-xb,mb,ub),sb=fb.min(qb,rb),Mb.width=Kb.width=Ib.width=Cb.width=qb-=qb%2,Kb.height=Ib.height=Cb.height=rb-=rb%2,Mb.height=xb},eb.onresize(),eb.appendChild(Mb),eb.appendChild(Cb);var Ub="#111",Vb="#222",Wb="#333",Xb="#444",Yb="#08e",Zb="#000",$b="#8f8",_b="#f02",ac=[["#aef","#5af"],["#fa0","#f53"],["#a64","#864","#fd7"],["rgba(255,255,255,0.5","#fff","#fff"],["#12d373","#333"]],bc="c",cc="l",dc="b",ec="bg",fc="bp",gc="o",hc="p",ic="m",jc="ring",kc=0,lc=1,mc=2,nc=3,oc=4,pc=["Water","Fire","Earth","Air"],qc={};qc[kc]=lc,qc[lc]=kc,qc[mc]=nc,qc[nc]=mc;var rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc,Gc=38,Hc=16,Ic=8,Jc=10,Kc=30,Lc=5,Mc=50,Nc=!1,Oc=!0,Pc=!1,Qc=100,Rc=0,Sc=0,Tc=0,Uc=0,Vc=10,Wc=.2,Xc=1,Yc=1,Zc=12,$c=.2*Vc,_c=.8*Vc,ad=0,bd=0,cd=0,dd=150,ed={},fd={},gd={},hd={};d(),x();var id={37:"left",65:"left",81:"left",38:"up",90:"up",87:"up",83:"down",40:"down",39:"right",68:"right",32:"space",27:"esc",13:"Enter"};db.onkeyup=function(a){$(!1,a),27==a.keyCode&&ab(),32==a.keyCode&&Oc&&ab()},db.onkeydown=function(a){$(!0,a)},db.onmousedown=function(a){_(!0,a)},db.onmouseup=function(a){_(!1,a)},db.onmousemove=function(a){hd.x=a.clientX+Eb,hd.y=a.clientY+Fb-xb},db.oncontextmenu=function(){return!1};var jd=0};