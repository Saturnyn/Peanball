function J(){this.B=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01),a=this.b+this.c+this.e,.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}var W=new function(){this.A=new J;var a,b,c,d,e,f,g,h,i,j,k,l;this.reset=function(){var a=this.A;d=100/(a.f*a.f+.001),e=100/(a.g*a.g+.001),f=1-a.h*a.h*a.h*.01,g=-a.i*a.i*a.i*1e-6,a.a||(k=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(0<a.l?-.9:10),i=0,j=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.D=function(){this.reset();var d=this.A;return a=d.b*d.b*1e5,b=d.c*d.c*1e5,c=d.e*d.e*1e5+12,3*((a+b+c)/3|0)},this.C=function(m,n){var o=this.A,p=1!=o.s||o.v,q=o.v*o.v*.1,r=1+3e-4*o.w,s=o.s*o.s*o.s*.1,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=o.r*o.r*o.r*.2,z=o.q*o.q*(0>o.q?-1020:1020),A=o.p?((1-o.p)*(1-o.p)*2e4|0)+32:0,B=o.d,C=o.j/2,D=o.k*o.k*.01,E=o.a,F=a,G=1/a,H=1/b,I=1/c,o=5/(1+o.u*o.u*20)*(.01+s);o>.8&&(o=.8);for(var J,K,L,M,N,o=1-o,O=!1,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=Array(1024),$=Array(32),_=Z.length;_--;)Z[_]=0;for(_=$.length;_--;)$[_]=2*Math.random()-1;for(_=0;n>_;_++){if(O)return _;if(A&&++X>=A&&(X=0,this.reset()),j&&++i>=j&&(j=0,d*=h),f+=g,d*=f,d>e&&(d=e,w>0&&(O=!0)),K=d,C>0&&(Y+=D,K*=1+Math.sin(Y)*C),K|=0,8>K&&(K=8),E||(k+=l,0>k?k=0:k>.5&&(k=.5)),++Q>F)switch(Q=0,++P){case 1:F=b;break;case 2:F=c}switch(P){case 0:R=Q*G;break;case 1:R=1+2*(1-Q*H)*B;break;case 2:R=1-Q*I;break;case 3:R=0,O=!0}x&&(z+=y,L=0|z,0>L?L=-L:L>1023&&(L=1023)),p&&r&&(q*=r,1e-5>q?q=1e-5:q>.1&&(q=.1)),N=0;for(var ab=8;ab--;){if(V++,V>=K&&(V%=K,3==E))for(J=$.length;J--;)$[J]=2*Math.random()-1;switch(E){case 0:M=k>V/K?.5:-.5;break;case 1:M=1-V/K*2;break;case 2:M=V/K,M=6.28318531*(M>.5?M-1:M),M=1.27323954*M+.405284735*M*M*(0>M?1:-1),M=.225*((0>M?-1:1)*M*M-M)+M;break;case 3:M=$[Math.abs(32*V/K|0)]}p&&(J=U,s*=t,0>s?s=0:s>.1&&(s=.1),u?(T+=(M-U)*s,T*=o):(U=M,T=0),U+=T,S+=U-J,M=S*=1-q),x&&(Z[W%1024]=M,M+=Z[(W-L+1024)%1024],W++),N+=M}N=.125*N*R*v,m[_]=N>=1?32767:-1>=N?-32768:32767*N|0}return n}};window.jsfxr=function(a){W.A.B(a);var b=W.D();a=new Uint8Array(4*((b+1)/2|0)+44);var b=2*W.C(new Uint16Array(a.buffer,44),b),c=new Uint32Array(a.buffer,0,44);c[0]=1179011410,c[1]=b+36,c[2]=1163280727,c[3]=544501094,c[4]=16,c[5]=65537,c[6]=44100,c[7]=88200,c[8]=1048578,c[9]=1635017060,c[10]=b;for(var b=b+44,c=0,d="data:audio/wav;base64,";b>c;c+=3)var e=a[c]<<16|a[c+1]<<8|a[c+2],d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&e]);return d};var aa;!function(){function a(){this.sounds={}}a.prototype.add=function(a,b,c){this.sounds[a]=[],c.forEach(function(c,d){this.sounds[a].push({tick:0,count:b,pool:[]});for(var e=0;b>e;e++){var f=new Audio;f.src=jsfxr(c),this.sounds[a][d].pool.push(f)}},this)},a.prototype.play=function(a){var b=this.sounds[a],c=b.length>1?b[Math.floor(Math.random()*b.length)]:b[0];c.pool[c.tick].play(),c.tick<c.count-1?c.tick++:c.tick=0},aa=new a,aa.add("start",1,[[0,.2,.13,.01,,.3328,,,,,,,,.0994,,,,,1,,,.1,,.5]]),aa.add("right",5,[[3,1,.3197,.7823,.2124,.1117,,.091,,,,,,,,.3901,.1061,-.0873,1,,,,,.5]]),aa.add("pad",1,[[0,,.0945,,.1582,.4416,,-.535,,,,,,.3856,,,,,1,,,.0896,,.5]]),aa.add("boost",1,[[0,,.2833,,.1918,.4914,,.2408,,,,,,.0182,,,,,1,,,,,.5]]),aa.add("ring",5,[[0,,.0177,.565,.2893,.4147,,,,,,.4159,.6958,,,,,,1,,,,,.5]]),aa.add("bumper",1,[[0,,.2389,,.2437,.5057,,.164,,,,,,.1032,,,,,1,,,,,.5]]),aa.add("hurt",1,[[0,,.2056,,.2341,.2899,,.3315,,,,,,.1817,,.6354,,,1,,,,,.5]]),aa.add("eat",1,[[0,,.3402,,.2772,.4978,,.1736,,.2589,.3885,,,.1153,,,,,1,,,,,.5]]),aa.add("die",1,[[3,,.296,.6924,.1761,.2478,,.0895,,,,-.6933,.8848,,,,,,1,,,,,.5]])}(),window.onload=function(){"use strict";function a(){function a(a,b,c,d){var e=4;T(Ab,Yb,Xb,2),Ab.beginPath(),Ab.moveTo(a(-e),b(-e)),Ab.lineTo(a(mb+nb),b(-e)),Ab.lineTo(a(mb+nb),b(mb)),Ab.arcTo(a(mb+nb),b(mb+nb),a(mb),b(mb+nb),nb),Ab.lineTo(a(-e),b(mb+nb)),Ab.closePath(),Ab.fill(),Ab.stroke(),B(C(a(mb),b(mb),nb,dc)),B(D(a(0),b(mb+nb),a(mb),b(mb+nb),dc)),B(D(a(mb+nb),b(0),a(mb+nb),b(mb),dc));var f=a==I?"⇐":"⇒";Ab.font="64px Georgia, serif",Ab.textAlign="center",Ab.textBaseline="middle",T(Ab,_b[c][1]),Ab.fillText(f,a(mb+nb+130)-2,b(50)-3),T(Ab,_b[d][1]),f=b==I?"⇑":"⇓",Ab.fillText(f,a(50)-2,b(mb+nb+130)-3),Ab.font="16px Georgia, serif",Ab.textAlign="center",Ab.textBaseline="middle",T(Ab,_b[c][1]),Ab.fillText(oc[c],a(mb+nb+30),b(12)),T(Ab,_b[d][1]),Ab.fillText(oc[d],a(16),b(mb+nb+12))}U(Sb,0,0,vb,vb,Ub),U(Sb,0,0,vb-1,vb-1,Vb),U(Sb,0,0,vb-2,vb-2,Tb),U(Ab,0,0,tb,tb,Rb),Ab.globalAlpha=.1,U(Ab,0,tb-mb-2,tb,mb,_b[jc][1]),U(Ab,tb-mb-2,0,mb,tb,_b[kc][1]),U(Ab,0,0,tb,mb,_b[lc][1]),U(Ab,0,0,mb,tb,_b[mc][1]),Ab.globalAlpha=1,Ab.globalCompositeOperation="source-over",T(Ab,Tb,Wb,2),X(Ab,0,0,tb,tb),X(Ab,tb,0,0,tb),W(Ab,ub,ub,8,jb,jb),a(I,I,2,3),a(I,J,0,3),a(J,I,2,1),a(J,J,0,1)}function b(){var a=yb,b=a/2;Ob.save(),Ob.translate(4,4),T(Ob,"#aef","#5af",2),Ob.beginPath(),Ob.moveTo(b,0),Ob.quadraticCurveTo(a,-3,a,b),Ob.quadraticCurveTo(a,a+1,b,a-2),Ob.quadraticCurveTo(2,a,0,b),Ob.quadraticCurveTo(-3,-1,b,0),Ob.fill(),Ob.stroke(),T(Ob,kb,"#fff",2),X(Ob,8,4,4,20),X(Ob,16,2,8,26,0,1),X(Ob,36,14,18,36,0,1),X(Ob,38,18,26,36,0,2),T(Ob,kb,"#58f",2),X(Ob,b-4,10,b-4,18),X(Ob,b+4,10,b+4,18),Ob.translate(a+8,0),T(Ob,"#fa0","#f00",2),Ob.beginPath(),Ob.moveTo(b,-4),Ob.lineTo(b+6,14),Ob.lineTo(a-4,8),Ob.quadraticCurveTo(a,a+3,b,a-2),Ob.quadraticCurveTo(2,a,4,8),Ob.lineTo(b-6,14),Ob.lineTo(b,-4),Ob.fill(),Ob.stroke(),X(Ob,b-3,26,b-8,20),X(Ob,b+3,26,b+8,20),Ob.translate(a+8,0),T(Ob,"#fd7","#d72",2),Ob.beginPath(),Ob.moveTo(b,0),Ob.quadraticCurveTo(a,10,a-8,a-8),Ob.quadraticCurveTo(a,a+1,b+2,a-6),Ob.quadraticCurveTo(14,a-12,2,a-4),Ob.quadraticCurveTo(-2,a-10,4,b),Ob.quadraticCurveTo(0,0,b,0),Ob.fill(),Ob.stroke(),T(Ob,"#d72"),W(Ob,10,7,1,jb),W(Ob,24,9,1,jb),W(Ob,7,20,1,jb),W(Ob,20,14,1,jb),W(Ob,8,30,1,jb),W(Ob,28,32,1,jb),T(Ob,"#000","#d72",1);for(var c=0;2>c;c++){var d;0===c?(Ob.globalCompositeOperation="destination-out",d=jb):(Ob.globalCompositeOperation="source-over",d=kb),Ob.scale(1,1.5),W(Ob,13,14,4,d,jb),Ob.scale(1,2/3),Ob.scale(1,1.5),W(Ob,26,14,4,d,jb),Ob.scale(1,2/3)}Ob.translate(a+8,0),Ob.lineCap="round",T(Ob,0,"#fff",2),W(Ob,b,b,b-4,kb,jb),T(0,0,1),Ob.beginPath(),Ob.arc(b,b,b-8,3.2,4.4),Ob.stroke(),W(Ob,b-4,b+4,4,kb,jb),W(Ob,b+4,b+4,4,kb,jb),Ob.restore()}function c(){if(!Pb.width){var a=4;Pb.width=2*(Hc+a)*Ic,Pb.height=2*(Hc+a);for(var b=0;Ic>b;b++){var c=170+b/Ic*68>>0;c=c.toString(16),T(Qb,null,"#"+c+c+"00",3);var d=(2*b+1)*(a+Hc),e=a+Hc;Qb.beginPath(),Qb.arc(d,e,Hc,0,2*gb),Qb.stroke()}}}function d(){Tc=0,yc=0,xc=Date.now(),Qc=0,Oc=!1,wc=Kc,Ec=0,qc=[],rc=[],a(),b(),c(),y()}function e(){if(!Oc&&!Tc)if(gd.right||fd.space)Pc>Qc&&Qc++;else if(Qc>0){var a=.1+.9*Qc/Pc,b=Zc+$c*a;_c=b*fb.cos(Sc),ad=b*fb.sin(Sc),bd=Xc+Yc*a,Oc=!0,Dc="start",aa.play("boost")}for(var c=0;c<uc.length;c++){var d,e=uc[c],f=!e.mirror;d=1==e.elt?f?fd.up||fd.right:fd.down||fd.left:f?fd.up||fd.left:fd.down||fd.right;var g=e.ux,h=e.uy;e.cpt=e.cpt||0;var i=9;if(e.max=!1,d?e.cpt<i?e.cpt++:e.max=!0:e.cpt>0&&e.cpt--,e.prevX2=e.x2,e.prevY2=e.y2,e.movingUp=d&&!e.max,e.moving=0!==e.cpt,e.cpt>0){var j=e.amax*(e.cpt/i);e.mirror&&(j*=-1);var k=fb.cos(j),l=fb.sin(j);g=e.ux*k-e.uy*l,h=e.ux*l+e.uy*k}e._ux=g,e._uy=h,e.x2=e.x+g,e.y2=e.y+h}gd.left&&tc.elt!=nc&&0===bd&&Ec>0&&(ed.x=gd.x-tc.x,ed.y=gd.y-tc.y,M(ed,Zc+.5*$c),tc.v.x=ed.x,tc.v.y=ed.y,bd=10,_c=tc.v.x,ad=tc.v.y,Dc="click",Ec-=10,gd.left=!1,aa.play("boost")),Ec>0&&Ec--}function f(){var a,b,c;for(b=vc.length,a=0;b>a;a++)c=vc[a],c.a+=c.da,c.x=ub+fb.cos(c.a)*c.d,c.y=ub+fb.sin(c.a)*c.d}function g(){var a,b,c,d,e;for(b=rc.length,a=0;b>a;a++){if(c=rc[a],c.elt!=tc.elt&&tc.elt!=nc){var f=L(tc.x-c.x,tc.y-c.y);200>f&&(c.elt==pc[tc.elt]?(c.tx=c.hx,c.ty=c.hy):(c.tx=tc.x,c.ty=tc.y))}if(d=c.tx-c.x,e=c.ty-c.y,25>d*d+e*e){var g=ib()*gb*2;c.tx=ub+fb.cos(g)*sb,c.ty=ub+fb.sin(g)*sb}else{var h=L(d,e);c.x+=d*Wc/h,c.y+=e*Wc/h}}}function h(){if(Oc){var a,b,c=0,d=0,e=Vc,f=Uc;a=ub-tc.x,b=ub-tc.y;var g=pb/2,h=L(a,b);g>h&&(a/=h,b/=h,e*=.2+.8*h/g,f*=.5+.5*h/g);var i=tc.x-ub,j=tc.y-ub;j>i?j>-i?d=e:c=-e:j>-i?c=e:d=-e,tc.v.x+=c,tc.v.y+=d,bd>0&&(bd--,tc.v.x+=_c,tc.v.y+=ad),tc.v.x*tc.v.x+tc.v.y*tc.v.y>f*f&&M(tc.v,f),tc.x+=tc.v.x,tc.y+=tc.v.y,tc.x=fb.round(tc.x),tc.y=fb.round(tc.y)}}function i(){var a,b,c,d;if(Oc){for(tc.collide=!1,d=qc.length,b=d+rc.length,a=0;b>a;a++){c=d>a?qc[a]:rc[a-d];var e=!1;if(c!=tc){c.collide=!1;var f=ed;c.shape==ac?N(tc,c)&&(j(c,f),c.collide&&m(c,f)):c.shape==bc&&(e=c.kind==gc&&c.movingUp,e?l(c,f):O(tc,c,f)&&(k(c,f),c.collide&&m(c,f)))}}tc.prevX=tc.x,tc.prevY=tc.y}}function j(a,b){if(a.kind!=hc||(pc[tc.elt]!=a.elt||a.dead||(a.dead=!0,Ec=cd,yc++,aa.play("eat")),!a.dead)){a.collide=!0,b.x=tc.x-a.x,b.y=tc.y-a.y;var c=L(b.x,b.y);if(a.kind==ec&&tc.elt!=nc&&(Ec+=50,Ec>cd&&(Ec=cd),aa.play("bumper")),a.kind==hc&&a.elt!=tc.elt){if(Cc=Lc,tc.elt=nc,sc.n<sc.length){sc.n++;var d=sc[sc.n-1];d.m=a,d.dx=b.x*(Fc-Hc)/c,d.dy=b.y*(Fc-Hc)/c,zc=Lc,Ac=-1}aa.play("hurt")}b.l=a.r+tc.r-c,b.x=b.x/c,b.y=b.y/c}}function k(a,b){var c;a.collide=!0,P(dd,a.x,a.y,a.x2,a.y2);var d=Q(dd,tc.x,tc.y)!==Q(dd,tc.prevX,tc.prevY);0>=d?c=tc.r-b.l:(c=tc.r+b.l,b.x*=-1,b.y*=-1),b.x/=b.l,b.y/=b.l,b.l=c}function l(a,b){var c,d,e=O(tc,a,b),f=1==a.elt||3==a.elt;if(e||(P(dd,a.x,a.y,a.prevX2,a.prevY2),c=Q(dd,tc.prevX,tc.prevY,f),P(dd,a.x,a.y,a.x2,a.y2),d=Q(dd,tc.x,tc.y,f)),e||c!==d){var g=tc.x-a.x,h=tc.y-a.y,i=g*a._ux+h*a._uy;if((e||i>0)&&(e||g*g+h*h<a.l*a.l)){a.collide=!0;var j=(L(g,h),i/a.l);b.x=a.x+j*a._ux/a.l,b.y=a.y+j*a._uy/a.l,b.x=tc.x-b.x,b.y=tc.y-b.y,b.l=L(b.x,b.y),b.x/=b.l,b.y/=b.l;var k=a._uy/a.l,l=-a._ux/a.l;(a.mirror&&(0===a.elt||3==a.elt)||!a.mirror&&(1==a.elt||2==a.elt))&&(k*=-1,l*=-1);var m=k*b.x+l*b.y;0>m&&(b.x*=-1,b.y*=-1),b.l=b.l+tc.r,tc.x+=b.x*b.l,tc.y+=b.y*b.l,tc.collide=!0;var n=j/a.l;n=.1+.9*(.3*n+.7*n*n);var o=Xc+n*Yc>>0,p=Zc+$c*n,q=b.x*p,r=b.y*p;bd&&Dc==gc?(bd=o,_c=.2*q+_c,ad=.2*r+ad):(aa.play("pad"),bd=o,_c=q,ad=r),Dc=gc,Ec=cd,_c*=.8+.4*ib(),ad*=.8+.4*ib(),tc.elt=a.elt}}}function m(a,b){bd=0,tc.collide=!0,a.colCpt=20,tc.x+=b.x*b.l,tc.y+=b.y*b.l;var c=L(tc.v.x,tc.v.y),d=tc.v.x/c,e=tc.v.y/c,f=-b.y,g=b.x,h=f*d+g*e;0>h&&(f=-f,g=-g);var i=d*b.x+e*b.y;0>i&&(i=-i);var j=fb.sin(fb.acos(i));0>j&&(j=-j);var k=.2;a.kind==ec?k=1.1:a.kind==hc&&(k=1.1),b.x*=i*k*c,b.y*=i*k*c,f*=j*c,g*=j*c,tc.v.x=b.x+f,tc.v.y=b.y+g}function n(){for(var a,b=(Gc+Hc)*(Gc+Hc),c=2*b,d=(Gc-Fc)*(Gc-Fc),e=rc.length,f=0;f<sc.n;f++){a=sc[f];var g=a.x-tc.x,h=a.y-tc.y,i=g*g+h*h;if(b>i)aa.play("ring"),a.m=null,sc[f]=sc[sc.n-1],sc[sc.n-1]=a,f--,sc.n--,zc=Lc,Ac=1,0===sc.n&&(Mc=!0);else if(c>i&&(a.x=a.x-.3*g,a.y=a.y-.3*h),a.m)a.m.dead?a.m=null:(a.x=a.m.x+a.dx,a.y=a.m.y+a.dy);else for(var j=0;e>j;j++){var k=rc[j];g=a.x-k.x,h=a.y-k.y,i=g*g+h*h,d>i&&(a.m=k,a.dx=g,a.dy=h)}}}function o(){f(),g(),h(),i(),n()}function p(){Fb=Db,Gb=Eb;var a=tc.x,b=tc.y,c=a-ub,d=b-ub,e=c,f=d;0>e&&(e*=-1),0>f&&(f*=-1);var g=lb/2+nb;if(g>e&&g>f){var h=e-g,i=f-g,j=h*h+i*i;if(g*g>j){var k=hb(j);h=h*g/k,i=i*g/k,a=h+g,b=i+g,0>c&&(a=-a),0>d&&(b=-b),a=ub+a,b=ub+b}}else f>e?a=ub:b=ub;a=K(a,tc.x-.3*pb,tc.x+.3*pb),b=K(b,tc.y-.3*qb,tc.y+.3*qb),a=K(a-pb/2,0,tb-pb),b=K(b-qb/2,0,tb-qb),Oc?(Db+=.1*(a-Db),Eb+=.1*(b-Eb)):(Db=a,Eb=b)}function q(){var a=Oc;Y(Cb),Y(Kb);a?(V(Cb,Hb,0,0),Ib.clearRect(0,0,pb,qb),Ib.save(),Ib.globalAlpha=.9,V(Ib,Bb,-Db+Fb,-Eb+Gb),Ib.restore(),Y(Cb),T(Ib,_b[tc.elt][1]),bd>0?W(Ib,tc.prevX-Db,tc.prevY-Eb,6,jb):W(Ib,tc.x-Db,tc.y-Eb,2,jb)):Y(Ib),r(),s(),t(),u(),V(Cb,zb,-Db,-Eb),a&&V(Cb,Hb,0,0),V(Cb,Jb,0,0)}function r(){for(var a,b,c=Db-Hc,d=Db+pb+Hc,e=Eb-Hc,f=Eb+pb+Hc,g=Pb.width/Ic,h=g/2,i=0,j=sc.n;j>i;i++){var k=sc[i];if(k.cpt+=k.cptDir,k.cpt>=Jc?(k.cpt=Jc,k.cptDir=-1):k.cpt<=0&&(k.cpt=0,k.cptDir=1),a=k.x,b=k.y,a>c&&d>a&&b>e&&f>b){var l=k.cpt/Jc*(Ic-1)>>0;Kb.drawImage(Pb,l*g,0,g,g,a-h-Db,b-h-Eb,g,g)}}}function s(){for(var a=yb+2*xb,b=0,c=rc.length;c>b;b++){var d=rc[b],e=1;d.dead?(d.cpt-=10,d.cpt<=0?z(d):e=d.cpt/50):d.cpt<50&&(d.cpt++,e=d.cpt/50),d.colCpt>0&&d.colCpt--;var f=pc[tc.elt]==d.elt,g=tc.elt==d.elt;T(Kb,g?Yb:f?_b[d.elt][0]:$b,g?d.colCpt>0?Zb:Xb:$b,2),Kb.globalAlpha=e*(g?.5:f?.2:.4),W(Kb,d.x-Db,d.y-Eb,d.r,jb),d.elt==mc&&(Kb.globalAlpha=1,Kb.globalCompositeOperation="destination-out",W(Kb,d.x-Db,d.y-Eb,17,jb),Kb.globalCompositeOperation="source-over"),Kb.globalAlpha=e,f||W(Kb,d.x-Db,d.y-Eb,d.r,kb,jb),Kb.globalAlpha=e*(g?.4:f?.7:1);var h=0,i=0;f&&(h=3*(fb.random()-.5),i=3*(fb.random()-.5)),g&&(Kb.globalAlpha=.4*e),Kb.drawImage(Nb,d.elt*a,0,a,a,d.x-a/2-Db+h,d.y-a/2-Eb+i,a,a)}Kb.globalAlpha=1}function t(){for(var a=0,b=qc.length;b>a;a++){var c,d=qc[a],e=d.x-Db,f=d.y-Eb;d!=tc&&(d.shape==ac&&d.kind==ec?(d.colCpt>0?(d.colCpt--,c=Zb):c=Xb,T(Kb,"#000",c,2),W(Kb,e,f,d.r,jb,jb)):d.shape==bc&&d.kind!=dc&&(c=Xb,d.kind==gc&&(c=_b[d.elt][1]),T(Kb,0,c,2),X(Kb,d.x-Db,d.y-Eb,d.x2-Db,d.y2-Eb)))}}function u(){if(!Tc){var a;Oc?(a=fb.atan2(tc.v.y,tc.v.x),Rc=0):(a=tc.sa,Rc+=.05),tc.cpt=++tc.cpt%20;var b=tc.cpt;b>10&&(b=20-b),Oc||(b=2+8*(Qc/Pc),a+=fb.cos(Rc)*gb/3,Sc=a),b*=.3*gb/10;var c=0,d=0;if(Qc>0&&!Oc){var e=4*K(Qc/Pc,0,1);c=e*ib(),d=e*ib()}tc.elt!=nc&&Ec>0&&(Kb.save(),Kb.translate(tc.x-Db+c,tc.y-Eb+d),Kb.rotate(a),T(Kb,"#fff","#000",1),Kb.beginPath(),Kb.arc(-10,0,20,0,2.2),Kb.lineTo(0,0),Kb.arc(-10,0,20,-0,-2.2,!0),Kb.lineTo(0,0),Kb.closePath(),Kb.fill(),Kb.stroke(),Kb.globalCompositeOperation="destination-out",W(Kb,0,0,Gc,"#fff"),Kb.restore()),Cc>0?T(Kb,_b[tc.elt][0],$b,3):T(Kb,_b[tc.elt][0],_b[tc.elt][1],2),0===b?W(Kb,tc.x-Db+c,tc.y-Eb+d,Gc,jb,jb):Z(Kb,tc.x-Db+c,tc.y-Eb+d,tc.r,a,b,jb,jb)}}function v(){var a=!1;tc.x+Gc<0?(a=!0,tc.x=50,tc.y=ub,tc.sa=0):tc.x-Gc>tb?(a=!0,tc.x=tb-50,tc.y=ub,tc.sa=-gb):tc.y+Gc<0?(a=!0,tc.y=50,tc.x=ub,tc.sa=gb/2):tc.y-Gc>tb&&(a=!0,tc.y=tb-50,tc.x=ub,tc.sa=-gb/2),a&&(Oc=!1,Qc=0,tc.elt=nc,tc.v.x=0,tc.v.y=0,Bc=Lc,Tc=Pc,wc--,0===wc&&(Mc=!0),aa.play("die")),Tc>0&&Tc--}function w(){Y(Mb);var a,b=9,c=14;for(a=0;wc>a;a++)T(Mb,_b[nc][0],"red"),Z(Mb,50+wb/2+a*(b+c),wb/2,b,0,.5,!0);if(Cc>0&&Cc--,Oc&&!Mc){var d=20,e=102,f=(pb-e)/2,g=(wb-d)/2;T(Mb,Vb),U(Mb,f,g,e,d),Cc&&(T(Mb,"#f00"),Mb.globalAlpha=Cc/Pc,U(Mb,f-2,g-2,e+4,d+4),Mb.globalAlpha=1),Ec>0&&tc.elt!=nc&&(Mb.font="12px Georgia, serif",Mb.textAlign="center",Mb.textBaseline="bottom",T(Mb,"#aaa"),Mb.fillText("Left click to boost !",f+e/2,g),T(Mb,"#fff"),e=(e-2)*(Ec/cd)>>0,f=(pb-e)/2+1,U(Mb,f,g,e,d),T(Mb,0,Vb,2),Mb.save(),Mb.translate(pb/2,g+10),Mb.rotate(-gb/2),Mb.beginPath(),Mb.arc(-10,0,18,-0,-1.4,!0),Mb.lineTo(0,0),Mb.closePath(),Mb.stroke(),Mb.beginPath(),Mb.arc(-10,0,18,0,1.4),Mb.lineTo(0,0),Mb.closePath(),Mb.stroke(),Mb.restore())}T(Mb,0,"#cc0",3),W(Mb,pb-20,wb/2,8,!1,!0);var h=(Date.now()-xc)/1e3>>0,i=h/60>>0,j=h%60;10>j&&(j="0"+j),h=i+":"+j,T(Mb,"#fff"),Mb.font="18px Georgia, serif",Mb.textAlign="left",Mb.textBaseline="middle",Mb.fillText(h,10,wb/2);var k;(!Oc||Mc)&&(Mb.textAlign="center",k=Mc?"Game over":Tc?"Out...":50>Qc?"Hold right mouse button or space key":"Release to launch !",Mb.fillText(k,pb/2,wb/2));var l=sc.length-sc.n,m=l+" / "+sc.length;if(zc>0&&(zc--,Ac>0?(T(Mb,"#0f0"),m="↑ "+m):(T(Mb,"#f00"),m="↓ "+m)),Mb.textAlign="right",Mb.fillText(m,pb-38,wb/2),Bc>0&&Bc--,Mc){var n=wc>0,o=[],p=0,q=1e4,r=100,s=200,t=1e3,u=0;if(o[p++]=n?{t:"YOU WIN :)",s:32,c:"#0f4"}:{t:"YOU LOSE :(",s:32,c:"#f04"},o[p++]={s:24},n?(u+=q,o[p++]={t1:"Finished game:",t2:q,s:18,c:"#ccc"},u+=t*wc,o[p++]={t1:"Extra balls:",t2:wc+" x "+t,s:18,c:"#ccc"}):(u+=r*l,o[p++]={t1:"Rings:",t2:l+" x "+r,s:18,c:"#ccc"}),u+=yc*s,o[p++]={t1:"Eaten monsters:",t2:yc+" x "+s,s:18,c:"#ccc"},h=(Date.now()-xc)/1e3>>0,h=20*(300-h)*l/sc.length>>0,0>h&&(h=0),u+=h,o[p++]={t1:"Time bonus:",t2:h,s:18,c:"#ccc"},o[p++]={t1:"Score:",t2:u,s:24,c:"#fff"},localStorage){var v=parseInt(localStorage.getItem("pacBallScoreMax"));(!v||u>v)&&localStorage.setItem("pacBallScoreMax",u),v&&(u>v?(o[p++]={s:24},o[p++]={t:"New Record !",s:24,c:"#fff"}):o[p++]={t1:"( Record:",t2:v+" )",s:18,c:"#ccc"})}for(o[p++]={s:48},o[p++]={t:"Press SPACE to restart",s:24,c:"#fff"},o[p++]={s:48},c=10,b=2*c,a=0;p>a;a++)b+=o[a].s+4;o.c="#fff";var w=lb/2-10,x=b;for(Cb.save(),Cb.translate((pb-w)/2>>0,(qb-x)/2>>0),T(Cb,"#000","#fff"),Cb.fillRect(0,0,w,x),Cb.strokeRect(0,0,w,x),Cb.textBaseline="top",a=0;p>a;a++)k=o[a],Cb.font=k.s+"px Georgia, serif",Cb.fillStyle=k.c,k.t?(Cb.textAlign="center",Cb.fillText(k.t,w/2,c)):k.t1&&(Cb.textAlign="right",Cb.fillText(k.t1,w/2-4,c),Cb.textAlign="left",Cb.fillText(k.t2,w/2+4,c)),Cb.translate(0,k.s+c);Cb.restore()}}function x(){window.stb&&stb(),Mc?fd.space&&(Mc=!1,d(),fd.space=!1):Nc?bb():(e(),o(),v(),p(),q(),w()),window.ste&&ste(),requestAnimationFrame(x)}function y(){tc=B(C(ub,tb-50,Gc,cc)),tc.v={x:0,y:0},tc.cpt=0,tc.elt=nc,tc.sa=-gb/2,F(D(0,210,140,100,fc)),vc=[];var a,b,c,d=4;for(b=0;d>b;b++){var e=Fc-4,f=2*e+(ob-2*e)*b/d,g=2*ib()*gb;a=C(0,0,e,ec),vc.push(B(a));var h=(.2+.2*ib())*(ib()>.5?-1:1);a.da=h/f,a.a=g,a.d=f}for(b=1;d>b;b++)for(c=0;b>c;c++)a=H(vc[b]),a.a+=2*gb*(c+1)/(b+1),vc.push(B(a));F(D(140,100,290,30,gc)),uc=qc.slice(-8);var i=uc[0],j=L(i.x-i.x2,i.y-i.y2),k=2*-fb.acos((i.x2-i.x)/j);for(b=0;b<uc.length;b++)i=uc[b],i.l=j,i.ux=i.x2-i.x,i.uy=i.y2-i.y,i.amax=k,(1==i.elt||2==i.elt)&&(i.amax*=-1);sc=[],sc.n=0,sc.cpt=0;var l,m,n=6,o=11,p=fb.random()*gb;for(b=1;n>=b;b++)for(c=1;o>=c;c++)m=2*gb*(c/o)+.1*b+p,l=A(ac,ic),l.r=Hc,l.cpt=ib()*Jc>>0,l.cptDir=ib()>.5?1:-1,sc[sc.n]=l,sc.n++,l.x=ub+fb.cos(m)*b*sb/n,l.y=ub+fb.sin(m)*b*sb/n;for(b=0;4>b;b++){var q=A(ac,hc);rc.push(q),q.elt=b,q.r=Fc,q.sy=0===b||1==b?mb:tb-mb,q.sx=0===b||3==b?mb:tb-mb,q.hx=ub+.5*lb*(1==b?1:3==b?-1:0),q.hy=ub+.5*lb*(0===b?1:2==b?-1:0),z(q)}}function z(a){a.tx=a.hx,a.ty=a.hy,a.x=a.sx,a.y=a.sy,a.cpt=0,a.dead=!1,a.da=0,a.a=0,a.d=1}function A(a,b,c,d){return{x:c||0,y:d||0,shape:a,kind:b}}function B(a){return qc.push(a),a}function C(a,b,c,d){var e=A(ac,d,a,b);return e.r=c,e}function D(a,b,c,d,e){var f=A(bc,e,a,b);return f.x2=c,f.y2=d,f}function E(a){for(var b=0;4>b;b++){var c=H(a);G(c,"x","y",b),c.shape==bc&&G(c,"x2","y2",b),B(c),c.elt=b}}function F(a){E(a),a.x=lb-a.x,a.shape==bc&&(a.x2=lb-a.x2),a.mirror=!0,E(a)}function G(a,b,c,d){var e=a[b],f=a[c];if(0===d||2==d)e+=mb+nb,0===d&&(f=tb-f);else{var g=f;f=mb+nb+e,e=g,1==d&&(e=tb-e)}a[b]=e,a[c]=f}function H(a){return JSON.parse(JSON.stringify(a))}function I(a){return a}function J(a){return tb-a}function K(a,b,c){return b>a?b:a>c?c:a}function L(a,b){return hb(a*a+b*b)}function M(a,b){b=(b||1)/L(a.x,a.y),a.x*=b,a.y*=b}function N(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.r+b.r;return e*e>c*c+d*d}function O(a,b,c){var d=a.x,e=a.y,f=a.r,g=b.x,h=b.y,i=b.x2,j=b.y2,k=i-g,l=j-h,m=fb.sqrt(k*k+l*l),n=(i-g)/m,o=(j-h)/m,p=n*(d-g)+o*(e-h),q=p*n+g,r=p*o+h;if((i>g&&q>=g&&i>=q||g>i&&q>=i&&g>=q||g==i&&q==g)&&(j>h&&r>=h&&j>=r||h>j&&r>=j&&h>=r||h==j&&r==h)){var s=r-e,t=q-d,u=hb(t*t+s*s);if(f>=u)return c.ex=q,c.ey=r,c.x=-t,c.y=-s,c.l=u,!0}return!1}function P(a,b,c,d,e){b==d?(a.vert=!0,a.x=b):(a.vert=!1,a.m=(c-e)/(b-d),a.p=c-a.m*b)}function Q(a,b,c,d){return a.vert?b<a.x:d?b>(c-a.p)/a.m:c>a.m*b+a.p}function R(a,b){var c=db.createElement("canvas");return c.width=a,c.height=b,c}function S(a){return a.getContext("2d")}function T(a,b,c,d){b&&(a.fillStyle=b),c&&(a.strokeStyle=c),d&&(a.lineWidth=d)}function U(a,b,c,d,e,f){f&&(f.width&&(f=a.createPattern(f,"repeat")),T(a,f)),a.fillRect(b,c,d,e)}function V(a,b,c,d){a.drawImage(b,c,d)}function W(a,b,c,d,e,f){a.beginPath(),a.arc(b,c,d,0,2*gb,!1),e&&a.fill(),f&&a.stroke()}function X(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.stroke()}function Y(a){a.clearRect(0,0,pb,qb)}function Z(a,b,c,d,e,f,g,h){a.beginPath(),a.arc(b,c,d,e+f,e-f),a.quadraticCurveTo(b-.5*d*fb.cos(e),c-.5*d*fb.sin(e),b+d*fb.cos(e+f),c+d*fb.sin(e+f)),a.closePath(),g&&a.fill(),h&&a.stroke()}function $(a,b){b||(b=window.e);var c=b.keyCode;b.charCode&&!c&&(c=b.charCode),fd[hd[c]]=a}function _(a,b){var c,d;"which"in b?(c=3==b.which,d=2==b.which):"button"in b&&(c=2==b.button,d=1==b.button),c?gd.right=a:d?gd.middle=a:gd.left=a,db.onmousemove(b)}function ab(){Nc=!Nc}function bb(){id++;var a=600,b=600;Y(Cb),Y(Mb),Cb.save(),U(Cb,0,0,tb,tb,Rb),Cb.translate(pb/2-a/2,0),U(Cb,0,0,a,b,"rgba(0,0,0,0.5)");var c="#b7f1d5",d="#0a7e45";Cb.font="96px impact",Cb.textAlign="center",Cb.textBaseline="top",T(Cb,c,d,2),Cb.fillText("Peanball",a/2,5),Cb.strokeText("Peanball",a/2,5);var e=fb.abs(.5*fb.cos(.05*id));T(Cb,_b[nc][0]),Z(Cb,20,b-20,40,0,e,jb,jb);for(var f=Pb.height,g=0;16>g;g++)Cb.drawImage(Pb,4*f,0,f,f,68+(10+f)*g,b-30,f,f);Cb.font="24px impact",Cb.textAlign="right",T(Cb,"#fff"),Cb.fillText("A game by @Saturnyn",a-128,105),Cb.font="24px impact",Cb.textAlign="right",T(Cb,c),Cb.fillText("Goal:",130,170),Cb.fillText("Controls:",130,210),Cb.fillText("Elements:",130,300),Cb.font="22px Georgia, serif",Cb.textAlign="left",T(Cb,"#fff"),Cb.fillText("Catch all the rings as fast as possible",140,174),Cb.font="16px Georgia, serif",Cb.fillText("• Hold and release SPACE or RIGHT CLICK to launch the ball",140,215),Cb.fillText("• Use WASD or ARROW keys to control flippers",140,240),Cb.fillText("• Use LEFT CLICK to give a boost (while wings are displayed)",140,265),Cb.fillText("• Flippers give the ball an elemental power (water/fire/earth/air)",140,305),Cb.fillText("• Those powers allows you to beat elemental monsters",140,330),Cb.fillText("    ‣ Fire to beat Ice , Water to beat Fire",140,355),Cb.fillText("    ‣ Air to beat Sand , Earth to beat Cristal",140,380),Cb.fillText("• Avoid touching other elements",140,405),Cb.textAlign="right",T(Cb,c),Cb.fillText("Mega thanks to Mod, Cédric and @Floriaen for their support !",a,b),Cb.font="32px impact",Cb.textAlign="center",T(Cb,c),Cb.fillText("Press SPACE to start the game",a/2,b-130),Cb.font="16px  Georgia, serif",T(Cb,"#aaa"),Cb.fillText("( play in full screen if you can )",a/2,b-90),Cb.restore()}var cb=window,db=cb.document,eb=db.body,fb=cb.Math,gb=fb.PI,hb=fb.sqrt,ib=fb.random,jb=!0,kb=!1,lb=680,mb=220,nb=200,ob=nb+lb/2;ob=L(ob,ob)-nb>>0;var pb,qb,rb,sb=(lb/2+L(lb/2,lb/2))/2,tb=lb+2*mb+2*nb,ub=tb/2,vb=20,wb=50,xb=4,yb=40,zb=R(tb,tb),Ab=S(zb),Bb=R(),Cb=S(Bb);Bb.style.cursor="crosshair";var Db,Eb,Fb,Gb,Hb=R(),Ib=S(Hb),Jb=R(),Kb=S(Jb),Lb=R(),Mb=S(Lb),Nb=R(4*(yb+2*xb),yb+2*xb),Ob=S(Nb),Pb=R(),Qb=S(Pb),Rb=R(vb,vb),Sb=S(Rb);window.onresize=function(){pb=K(cb.innerWidth,lb/2,tb),qb=K(cb.innerHeight-wb,lb/2,tb),rb=fb.min(pb,qb),Lb.width=Jb.width=Hb.width=Bb.width=pb-=pb%2,Jb.height=Hb.height=Bb.height=qb-=qb%2,Lb.height=wb},eb.onresize(),eb.appendChild(Lb),eb.appendChild(Bb);var Tb="#111",Ub="#222",Vb="#333",Wb="#444",Xb="#08e",Yb="#000",Zb="#8f8",$b="#f02",_b=[["#aef","#5af"],["#fa0","#f53"],["#a64","#864","#fd7"],["rgba(255,255,255,0.5","#fff","#fff"],["#12d373","#333"]],ac="c",bc="l",cc="b",dc="bg",ec="bp",fc="o",gc="p",hc="m",ic="ring",jc=0,kc=1,lc=2,mc=3,nc=4,oc=["Water","Fire","Earth","Air"],pc={};pc[jc]=kc,pc[kc]=jc,pc[lc]=mc,pc[mc]=lc;var qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc,Dc,Ec,Fc=38,Gc=16,Hc=8,Ic=10,Jc=30,Kc=5,Lc=50,Mc=!1,Nc=!0,Oc=!1,Pc=100,Qc=0,Rc=0,Sc=0,Tc=0,Uc=10,Vc=.2,Wc=1,Xc=1,Yc=12,Zc=.2*Uc,$c=.8*Uc,_c=0,ad=0,bd=0,cd=150,dd={},ed={},fd={},gd={};d(),x();var hd={37:"left",65:"left",81:"left",38:"up",90:"up",87:"up",83:"down",40:"down",39:"right",68:"right",32:"space",27:"esc",13:"Enter"};db.onkeyup=function(a){$(!1,a),27==a.keyCode&&ab(),32==a.keyCode&&Nc&&ab()},db.onkeydown=function(a){$(!0,a)},db.onmousedown=function(a){_(!0,a)},db.onmouseup=function(a){_(!1,a)},db.onmousemove=function(a){gd.x=a.clientX+Db,gd.y=a.clientY+Eb-wb},db.oncontextmenu=function(){return!1};var id=0};