window.onload=function(){"use strict";function a(){function a(a,b,c){var h=4;C(jb,Db,Cb,2),jb.beginPath(),jb.moveTo(a(-h),b(-h)),jb.lineTo(a(X+Y),b(-h)),jb.lineTo(a(X+Y),b(X)),jb.arcTo(a(X+Y),b(X+Y),a(X),b(X+Y),Y),jb.lineTo(a(-h),b(X+Y)),jb.closePath(),jb.fill(),jb.stroke(),k(l(a(X),b(X),Y,Ob)),k(m(a(0),b(X+Y),a(X),b(X+Y),Ob)),k(m(a(X+Y),b(0),a(X+Y),b(X),Ob)),C(jb,Ib[c]);var i=a==r?f:g;jb.fillText(R(i),a(X+Y+130)-2,b(50)-3),i=b==r?d:e,jb.fillText(R(i),a(50)-2,b(X+Y+130)-3)}var b=A(hb,hb),c=B(b);D(c,0,0,hb,hb,zb),D(c,0,0,hb-1,hb-1,Ab),D(c,0,0,hb-2,hb-2,yb),D(jb,0,0,fb,fb,b),jb.globalAlpha=.1,D(jb,0,fb-X-2,fb,X,Ib[S][1]),D(jb,fb-X-2,0,X,fb,Ib[T][1]),D(jb,0,0,fb,X,Ib[U][1]),D(jb,0,0,X,fb,Ib[V][1]),jb.globalAlpha=1,jb.globalCompositeOperation="source-over",G(jb,0,0,fb,fb,Bb),G(jb,fb,0,0,fb,Bb),F(jb,gb,gb,8,yb,Bb);var d=8679,e=8681,f=8678,g=8680;jb.font="64px sans-serif",jb.textAlign="center",jb.textBaseline="middle",a(r,r,0),a(r,s,1),a(s,r,2),a(s,s,3);var h=Kb,i=h/2;rb.translate(4,4),C(rb,"#aef","#5af",2),rb.beginPath(),rb.moveTo(i,0),rb.quadraticCurveTo(h,-3,h,i),rb.quadraticCurveTo(h,h+1,i,h-2),rb.quadraticCurveTo(2,h,0,i),rb.quadraticCurveTo(-3,-1,i,0),rb.fill(),rb.stroke(),G(rb,8,4,4,20,"#fff",2),G(rb,16,2,8,26,0,1),G(rb,36,14,18,36,0,1),G(rb,38,18,26,36,0,2),G(rb,i-4,10,i-4,18,"#58f",2),G(rb,i+4,10,i+4,18),rb.translate(h+8,0),C(rb,"#fa0","#f00",2),rb.beginPath(),rb.moveTo(i,-4),rb.lineTo(i+6,14),rb.lineTo(h-4,8),rb.quadraticCurveTo(h,h+3,i,h-2),rb.quadraticCurveTo(2,h,4,8),rb.lineTo(i-6,14),rb.lineTo(i,-4),rb.fill(),rb.stroke(),G(rb,i-3,26,i-8,20),G(rb,i+3,26,i+8,20),rb.translate(h+8,0),C(rb,"#fd7","#d72",2),rb.beginPath(),rb.moveTo(i,0),rb.quadraticCurveTo(h,10,h-8,h-8),rb.quadraticCurveTo(h,h+1,i+2,h-6),rb.quadraticCurveTo(14,h-12,2,h-4),rb.quadraticCurveTo(-2,h-10,4,i),rb.quadraticCurveTo(0,0,i,0),rb.fill(),rb.stroke(),F(rb,10,7,1,"#d72"),F(rb,24,9,1),F(rb,7,20,1),F(rb,20,14,1),F(rb,8,30,1),F(rb,28,32,1);for(var j=0;2>j;j++){var n;0===j?(rb.globalCompositeOperation="destination-out",n="#000"):(rb.globalCompositeOperation="source-over",n=null),rb.scale(1,1.5),F(rb,13,14,4,n,"#d72",1),rb.scale(1,2/3),rb.scale(1,1.5),F(rb,26,14,4,n,"#d72",1),rb.scale(1,2/3)}rb.translate(h+8,0),rb.lineCap="round",F(rb,i,i,i-4,"rgba(255,255,255,0.1)","#fff",2),C(0,0,1),rb.beginPath(),rb.arc(i,i,i-8,3.2,4.4),rb.stroke(),F(rb,i-4,i+4,4,0,"#fff",2),F(rb,i+4,i+4,4,0,"#fff",2)}function b(){_b=0,$b=!1,sb=[],tb=[],ub=[],ub.n=0,tb.n=0,a(),i()}function c(){if(!$b){if(Yb.space)_b++;else if(_b>0){var a=_b/ac;a>1&&(a=1),vb.boostX=3*(1+Q()),vb.boostY=-Ub,vb.boostCpt=10+50*a,$b=!0}Yb.R&&($b=!0)}for(var b=0;b<wb.length;b++){var c,d=wb[b],e=!d.mirror;c=1==d.table?e?Yb.up||Yb.right:Yb.down||Yb.left:e?Yb.up||Yb.left:Yb.down||Yb.right;var f=d.ux,g=d.uy;d.cpt=d.cpt||0;var h=7;if(d.max=!1,c?d.cpt<h?d.cpt++:d.max=!0:d.cpt>0&&d.cpt--,d.prevX2=d.x2,d.prevY2=d.y2,d.movingUp=c&&!d.max,d.moving=0!==d.cpt,d.cpt>0){var i=d.amax*(d.cpt/h);d.mirror&&(i*=-1);var k=N.cos(i),l=N.sin(i);f=d.ux*k-d.uy*l,g=d.ux*l+d.uy*k}d._ux=f,d._uy=g,d.x2=d.x+f,d.y2=d.y+g}if(Zb.middle&&(_b=0,$b=!0,vb.x=Zb.x,vb.y=Zb.y,vb.a.x=vb.a.y=0,vb.v.x=vb.v.y=0,vb.boostCpt=0,Zb.right=!1,console.log("mouse teleport",vb)),Zb.right&&(cc.x=Zb.x-vb.x,cc.y=Zb.y-vb.y,v(cc),vb.boostCpt=6,vb.boostX=2.5*cc.x,vb.boostY=2.5*cc.y,Zb.right=!1),Zb.left&&(cc.x=Zb.x-vb.x,cc.y=Zb.y-vb.y,v(cc),Zb.leftCpt%10===0)){var m;tb.length==tb.n?(m=j(Mb,Sb),tb.push(m)):m=tb[tb.n],tb.n++;var n=10;m.x=vb.x+cc.x*(n+Vb),m.y=vb.y+cc.y*(n+Vb),m.v.x=cc.x*n,m.v.y=cc.y*n,m.cpt=100}Zb.left?Zb.leftCpt++:Zb.leftCpt=0}function d(){var a,b,c,d;for(b=xb.length,d=xb.length+ub.n,a=0;d>a;a++)c=b>a?xb[a]:ub[a-b],c.a=c.a+c.da,c.x=gb+N.cos(c.a)*c.d,c.y=gb+N.sin(c.a)*c.d;if($b){vb.boostCpt>0&&(vb.boostCpt--,vb.a.x=vb.boostX,vb.a.y=vb.boostY);var e=0,f=0,g=Wb;t=gb-vb.x,A=gb-vb.y;var h=$/2,i=u(t,A);h>i&&(t/=i,A/=i,g*=.1+.9*i/h);var j=vb.x-gb,k=vb.y-gb;k>j?k>-j?f=g:e=-g:k>-j?e=g:f=-g,vb.a.x+=e,vb.a.y+=f,vb.v.x=vb.v.x+vb.a.x,vb.v.y=vb.v.y+vb.a.y,vb.v.x*=Xb,vb.v.y*=Xb,vb.v.x*vb.v.x+vb.v.y*vb.v.y>Ub*Ub&&v(vb.v,Ub),vb.x+=vb.v.x,vb.y+=vb.v.y,vb.collide=!1;{vb.v.x,vb.v.y}for(d=sb.length,b=d+ub.n,a=0;b>a;a++)if(c=d>a?sb[a]:ub[a-d],c!=vb){c.collide=!1;var l,m=cc;if(c.shape==Lb)w(vb,c)&&(c.collide=!0,m.x=vb.x-c.x,cc.y=vb.y-c.y,l=u(m.x,m.y),m.l=c.r+vb.r-l,m.x=m.x/l,m.y=m.y/l);else if(c.shape==Mb){var n=c.kind==Rb&&c.movingUp;if(!n&&x(vb,c,m)){c.collide=!0,y(bc,c.x,c.y,c.x2,c.y2);var o=z(bc,vb.x,vb.y)!==z(bc,vb.prevX,vb.prevY);0>=o?l=vb.r-m.l:(l=vb.r+m.l,m.x*=-1,m.y*=-1),m.x/=m.l,m.y/=m.l,m.l=l}if(n){var p=x(vb,c,m),q=1==c.table||3==c.table;console.log("rising paddle",c,q?"REVERSE":"");var r,s;if(p?console.log(" paddle direct collision"):(y(bc,c.x,c.y,c.prevX2,c.prevY2),r=z(bc,vb.prevX,vb.prevY,q),console.log(" before",0,0,"and",c.prevX2-c.x,c.prevY2-c.y,r,"m",bc.m,"p",bc.p),console.log(" ball before:",vb.prevX-c.x,vb.prevY-c.y),y(bc,c.x,c.y,c.x2,c.y2),s=z(bc,vb.x,vb.y,q),console.log(" after",0,0,"and",c.x2-c.x,c.y2-c.y,s,"m",bc.m,"p",bc.p),console.log(" ball now:",vb.x-c.x,vb.y-c.y)),p||r!==s){p||console.log("  checking dotprod");var t=vb.x-c.x,A=vb.y-c.y,B=t*c._ux+A*c._uy;if((p||B>0)&&(p||t*t+A*A<c.l*c.l)){c.collide=!0;var C=(u(t,A),B/c.l);m.x=c.x+C*c._ux/c.l,m.y=c.y+C*c._uy/c.l,m.x=vb.x-m.x,m.y=vb.y-m.y,m.l=u(m.x,m.y),m.x/=m.l,m.y/=m.l;var D=c._uy/c.l,E=-c._ux/c.l;console.log("   NORMALE PAD",D,E,c),(c.mirror&&(0===c.table||3==c.table)||!c.mirror&&(1==c.table||2==c.table))&&(D*=-1,E*=-1);var F=D*m.x+E*m.y;0>F&&(m.x*=-1,m.y*=-1),m.l=m.l+vb.r,vb.x+=m.x*m.l,vb.y+=m.y*m.l,vb.collide=!0;var G=C/c.l;G=.2+(.3*G+.7*G*G);var H=20*G>>0,I=Ub*G,J=m.x*I,K=m.y*I;vb.boostCpt?(vb.boostCpt+=H>2?2:H,vb.boostX=.2*J+.8*vb.boostX,vb.boostY=.2*K+.8*vb.boostY):(vb.boostCpt=H,vb.boostX=J,vb.boostY=K),vb.boostX*=.6+.8*Q(),vb.boostY*=.6+.8*Q(),console.log("   boosting",G,vb.boostCpt,vb.boostX,vb.boostY);continue}}}}if(c.collide){c.colCpt=20,vb.x+=m.x*m.l,vb.y+=m.y*m.l,vb.collide=!0;var L=u(vb.v.x,vb.v.y),M=vb.v.x/L,O=vb.v.y/L,P=-m.y,R=m.x,S=P*M+R*O;0>S&&(P=-P,R=-R);var T=M*m.x+O*m.y;0>T&&(T=-T);var U=N.sin(N.acos(T));0>U&&(U=-U);var V=.2;c.kind==Pb?V=1.5:c.kind==Tb&&(V=-.1),m.x*=T*V*L,m.y*=T*V*L,P*=U*L,R*=U*L,vb.v.x=m.x+P,vb.v.y=m.y+R}}vb.a.x=vb.a.y=0,vb.prevX=vb.x,vb.prevY=vb.y,vb.x+Vb<0?$b=!1:vb.x-Vb>fb?$b=!1:vb.y+Vb<0?$b=!1:vb.y-Vb>fb&&($b=!1)}var W;for(a=0,b=tb.n;b>a;a++)W=tb[a],W.cpt--,W.cpt>0&&(W.x+=W.v.x,W.y+=W.v.y);for(a=0;a<tb.n;a++)W=tb[a],0===W.cpt&&(tb[a]=tb[tb.n-1],tb[tb.n-1]=W,tb.n--,a--)}function e(){db=bb,eb=cb;var a=vb.x,b=vb.y,c=a-gb,d=b-gb,e=c,f=d;0>e&&(e*=-1),0>f&&(f*=-1);var g=W/2+Y;if(g>e&&g>f){var h=e-g,i=f-g,j=h*h+i*i;if(g*g>j){var k=P(j);h=h*g/k,i=i*g/k,a=h+g,b=i+g,0>c&&(a=-a),0>d&&(b=-b),a=gb+a,b=gb+b}}else f>e?a=gb:b=gb;a=t(a,vb.x-.3*$,vb.x+.3*$),b=t(b,vb.y-.3*_,vb.y+.3*_),a=t(a-$/2,0,fb-$),b=t(b-_/2,0,fb-_),$b?(bb+=.3*(a-bb),cb+=.3*(b-cb)):(bb=a,cb=b)}function f(){H(lb),H(pb),E(lb,mb,0,0),nb.clearRect(0,0,$,_),nb.save(),nb.globalAlpha=.9,E(nb,kb,-bb+db,-cb+eb),nb.restore(),H(lb),vb.boostCpt>0?(F(nb,vb.x-bb,vb.y-cb,6,"orange"),F(nb,vb.prevX-bb,vb.prevY-cb,6,"orange")):F(nb,vb.x-bb,vb.y-cb,2,"white");for(var a=0,b=sb.length;b>a;a++){var c,d,e,f=sb[a],g=f.x-bb,h=f.y-cb;if(f==vb){if(_b>0&&!$b){var i=4*t(_b/ac,0,1)>>0;g+=i*Q()>>0,h+=i*Q()>>0,4==i&&(d="#f00")}var j=N.atan2(vb.v.y,vb.v.x);vb.cpt=++vb.cpt%20;var k=vb.cpt;k>10&&(k=20-k),0===k?F(pb,vb.x-bb,vb.y-cb,Vb,Gb,Fb):(C(pb,Gb,Fb,2),k*=.3*O/10,pb.beginPath(),pb.arc(vb.x-bb,vb.y-cb,vb.r,j+k,j-k),pb.lineTo(vb.x-bb,vb.y-cb),pb.closePath(),pb.fill(),pb.stroke())}else f.shape==Lb?(f.kind==Ob?(c=0,d=0):(e=2,d=Cb,c="#000",f.colCpt>0&&(f.colCpt--,d=Eb)),(c||d)&&F(pb,g,h,f.r,c,d,e)):f.shape==Mb&&(f.kind==Ob?d=0:(d=Cb,f.kind==Rb&&(d=Ib[f.table][1])),d&&G(pb,f.x-bb,f.y-cb,f.x2-bb,f.y2-cb,d,2))}for(a=0,b=ub.n;b>a;a++){var l=1,m=ub[a],n=Kb+2*Jb;if(m.dead){if(m.cpt--,0===m.cpt){l=ub[ub.n-1],ub[a]=l,ub[ub.n-1]=m,ub.n--,a--;continue}l=m.cpt/50}else m.cpt<50&&(m.cpt++,l=m.cpt/50);pb.globalAlpha=.2*l,F(pb,m.x-bb,m.y-cb,m.r,Ib[m.elt][0]),m.elt==V&&(pb.globalAlpha=1,pb.globalCompositeOperation="destination-out",F(pb,m.x-bb,m.y-cb,17,Ib[m.elt][0]),pb.globalCompositeOperation="source-over"),pb.globalAlpha=l,F(pb,m.x-bb,m.y-cb,m.r,null,Ib[m.elt][0]),E(pb,qb,m.elt*n,0,n,n,m.x-n/2-bb,m.y-n/2-cb,n,n)}pb.globalAlpha=1;var o;for(a=0,b=tb.n;b>a;a++)o=tb[a],F(pb,o.x-bb,o.y-cb,4,Hb),G(nb,o.x-bb,o.y-cb,o.x-o.v.x-bb,o.y-o.v.y-cb,Hb,2);E(lb,ib,-bb,-cb),E(lb,mb,0,0),E(lb,ob,0,0)}function g(){for(var a=6;ub.n<a;){var b;ub.length==ub.n?(b=j(Lb,Tb),ub.push(b),b.elt=ub.n%4,b.r=Kb-2):b=ub[ub.n],ub.n++;var c=xb[ub.n%xb.length];b.x=c.x,b.y=c.y,b.cpt=0,b.dead=0,b.da=-2*c.da,b.a=c.a,b.d=c.d}}function h(){stb&&stb(),c(),d(),e(),f(),g(),window.requestAnimationFrame(h),ste&&ste()}function i(){vb=k(l(gb,fb-50,Vb,Nb)),vb.cpt=0,o(m(0,220,150,100,Qb)),xb=[];for(var a=10,b=0;a>b;b++){var c=20+30*Q(),d=80+c+(Z-2*c-80)*b/a>>0,e=2*Q()*O,f=l(0,0,c,Pb);xb.push(k(f));var g=.2+.2*Q()*(Q()>.5?-1:1);f.da=g/d,f.a=e,f.d=d,console.log(f.da)}o(m(150,100,300,30,Rb)),wb=sb.slice(-8);var h=wb[0],i=u(h.x-h.x2,h.y-h.y2),j=2*-N.acos((h.x2-h.x)/i);for(b=0;b<wb.length;b++)h=wb[b],h.l=i,h.ux=h.x2-h.x,h.uy=h.y2-h.y,h.amax=j,(1==h.table||2==h.table)&&(h.amax*=-1)}function j(a,b,c,d){return{x:c||0,y:d||0,shape:a,kind:b,v:{x:0,y:0},a:{x:0,y:0}}}function k(a){return sb.push(a),a}function l(a,b,c,d){var e=j(Lb,d,a,b);return e.r=c,e}function m(a,b,c,d,e){var f=j(Mb,e,a,b);return f.x2=c,f.y2=d,f}function n(a){for(var b=0;4>b;b++){var c=q(a);p(c,"x","y",b),c.shape==Mb&&p(c,"x2","y2",b),k(c),c.table=b}}function o(a){n(a),a.x=W-a.x,a.shape==Mb&&(a.x2=W-a.x2),a.mirror=!0,n(a)}function p(a,b,c,d){var e=a[b],f=a[c];if(0===d||2==d)e+=X+Y,0===d&&(f=fb-f);else{var g=f;f=X+Y+e,e=g,1==d&&(e=fb-e)}a[b]=e>>0,a[c]=f>>0}function q(a){return JSON.parse(JSON.stringify(a))}function r(a){return a}function s(a){return fb-a}function t(a,b,c){return b>a?b:a>c?c:a}function u(a,b){return P(a*a+b*b)}function v(a,b){b=(b||1)/u(a.x,a.y),a.x*=b,a.y*=b}function w(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.r+b.r;return e*e>c*c+d*d}function x(a,b,c){var d=a.x,e=a.y,f=a.r,g=b.x,h=b.y,i=b.x2,j=b.y2,k=i-g,l=j-h,m=N.sqrt(k*k+l*l),n=(i-g)/m,o=(j-h)/m,p=n*(d-g)+o*(e-h),q=p*n+g,r=p*o+h;if((i>g&&q>=g&&i>=q||g>i&&q>=i&&g>=q||g==i&&q==g)&&(j>h&&r>=h&&j>=r||h>j&&r>=j&&h>=r||h==j&&r==h)){var s=r-e,t=q-d,u=P(t*t+s*s);if(f>=u)return c.ex=q,c.ey=r,c.x=-t,c.y=-s,c.l=u,!0}return!1}function y(a,b,c,d,e){b==d?(a.vert=!0,a.x=b):(a.vert=!1,a.m=(c-e)/(b-d),a.p=c-a.m*b)}function z(a,b,c,d){return a.vert?b<a.x:d?b>(c-a.p)/a.m:c>a.m*b+a.p}function A(a,b){var c=L.createElement("canvas");return c.width=a,c.height=b,c}function B(a){return a.getContext("2d")}function C(a,b,c,d){0!==b&&(a.fillStyle=b),0!==c&&(a.strokeStyle=c),0!==d&&(a.lineWidth=d)}function D(a,b,c,d,e,f){f&&(f.width&&(f=a.createPattern(f,"repeat")),C(a,f)),a.fillRect(b,c,d,e)}function E(){var a=[].slice.call(arguments),b=a.shift();b.drawImage.apply(b,a)}function F(a,b,c,d,e,f,g){C(a,e,f,g||2),a.beginPath(),a.arc(b,c,d,0,2*O,!1),e&&a.fill(),f&&a.stroke(),a.closePath()}function G(a,b,c,d,e,f,g){C(a,0,f,g||2),a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.stroke()}function H(a){a.clearRect(0,0,$,_)}function I(a,b){b||(b=window.e);var c=b.keyCode;b.charCode&&!c&&(c=b.charCode),Yb[dc[c]]=a}function J(a,b){var c,d;"which"in b?(c=3==b.which,d=2==b.which):"button"in b&&(c=2==b.button,d=1==b.button),c?Zb.right=a:d?Zb.middle=a:Zb.left=a,Zb.x=b.clientX+bb,Zb.y=b.clientY+cb}var K=window,L=K.document,M=L.body,N=K.Math,O=N.PI,P=N.sqrt,Q=N.random,R=String.fromCharCode,S=0,T=1,U=2,V=3,W=700,X=220,Y=200,Z=Y+W/2;Z=u(Z,Z)-Y>>0;var $,_,ab,bb,cb,db,eb,fb=W+2*X+2*Y,gb=fb/2,hb=20,ib=A(fb,fb),jb=B(ib),kb=A($,_),lb=B(kb),mb=A($,_),nb=B(mb),ob=A($,_),pb=B(ob),qb=A(400,100),rb=B(qb);window.onresize=function(){$=t(K.innerWidth,W,fb),_=t(K.innerHeight,W,fb),ab=N.min($,_),ob.width=mb.width=kb.width=$-=$%2,ob.height=mb.height=kb.height=_-=_%2},M.onresize(),M.appendChild(kb);var sb,tb,ub,vb,wb,xb,yb="#111",zb="#222",Ab="#333",Bb="#444",Cb="#08e",Db="#000",Eb="#0d0",Fb="#000",Gb="#fff",Hb="#fa0",Ib=[["#aef","#5af"],["#fa0","#f00"],["#d72","#d72"],["#fff","#fff"]],Jb=4,Kb=40,Lb="c",Mb="l",Nb="b",Ob="bg",Pb="bp",Qb="o",Rb="p",Sb="s",Tb="m",Ub=15,Vb=14,Wb=.2,Xb=.99,Yb={},Zb={},$b=!1,_b=0,ac=100,bc={},cc={};b(),h();var dc={37:"left",38:"up",39:"right",40:"down",32:"space",27:"esc",82:"R",13:"Enter"};L.onkeyup=function(a){I(!1,a),27==a.keyCode&&(window._stopped?(window._stopped=!1,window.requestAnimationFrame=window._raf):(window._stopped=!0,window._raf=window.requestAnimationFrame,window.requestAnimationFrame=function(){})),13==a.keyCode&&window._stopped&&h()},L.onkeydown=function(a){I(!0,a)},L.onmousedown=function(a){J(!0,a)},L.onmouseup=function(a){J(!1,a)},L.onmousemove=function(a){Zb.x=a.clientX+bb,Zb.y=a.clientY+cb},L.oncontextmenu=function(){return!1}};