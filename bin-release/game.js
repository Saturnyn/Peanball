function J(){this.B=function(a){for(var b=0;24>b;b++)this[String.fromCharCode(97+b)]=a[b]||0;.01>this.c&&(this.c=.01),a=this.b+this.c+this.e,.18>a&&(a=.18/a,this.b*=a,this.c*=a,this.e*=a)}}var W=new function(){this.A=new J;var a,b,c,d,e,f,g,h,i,j,k,l;this.reset=function(){var a=this.A;d=100/(a.f*a.f+.001),e=100/(a.g*a.g+.001),f=1-a.h*a.h*a.h*.01,g=-a.i*a.i*a.i*1e-6,a.a||(k=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(0<a.l?-.9:10),i=0,j=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.D=function(){this.reset();var d=this.A;return a=d.b*d.b*1e5,b=d.c*d.c*1e5,c=d.e*d.e*1e5+12,3*((a+b+c)/3|0)},this.C=function(m,n){var o=this.A,p=1!=o.s||o.v,q=o.v*o.v*.1,r=1+3e-4*o.w,s=o.s*o.s*o.s*.1,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=o.r*o.r*o.r*.2,z=o.q*o.q*(0>o.q?-1020:1020),A=o.p?((1-o.p)*(1-o.p)*2e4|0)+32:0,B=o.d,C=o.j/2,D=o.k*o.k*.01,E=o.a,F=a,G=1/a,H=1/b,I=1/c,o=5/(1+o.u*o.u*20)*(.01+s);o>.8&&(o=.8);for(var J,K,L,M,N,o=1-o,O=!1,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=0,Z=Array(1024),$=Array(32),_=Z.length;_--;)Z[_]=0;for(_=$.length;_--;)$[_]=2*Math.random()-1;for(_=0;n>_;_++){if(O)return _;if(A&&++X>=A&&(X=0,this.reset()),j&&++i>=j&&(j=0,d*=h),f+=g,d*=f,d>e&&(d=e,w>0&&(O=!0)),K=d,C>0&&(Y+=D,K*=1+Math.sin(Y)*C),K|=0,8>K&&(K=8),E||(k+=l,0>k?k=0:k>.5&&(k=.5)),++Q>F)switch(Q=0,++P){case 1:F=b;break;case 2:F=c}switch(P){case 0:R=Q*G;break;case 1:R=1+2*(1-Q*H)*B;break;case 2:R=1-Q*I;break;case 3:R=0,O=!0}x&&(z+=y,L=0|z,0>L?L=-L:L>1023&&(L=1023)),p&&r&&(q*=r,1e-5>q?q=1e-5:q>.1&&(q=.1)),N=0;for(var ab=8;ab--;){if(V++,V>=K&&(V%=K,3==E))for(J=$.length;J--;)$[J]=2*Math.random()-1;switch(E){case 0:M=k>V/K?.5:-.5;break;case 1:M=1-V/K*2;break;case 2:M=V/K,M=6.28318531*(M>.5?M-1:M),M=1.27323954*M+.405284735*M*M*(0>M?1:-1),M=.225*((0>M?-1:1)*M*M-M)+M;break;case 3:M=$[Math.abs(32*V/K|0)]}p&&(J=U,s*=t,0>s?s=0:s>.1&&(s=.1),u?(T+=(M-U)*s,T*=o):(U=M,T=0),U+=T,S+=U-J,M=S*=1-q),x&&(Z[W%1024]=M,M+=Z[(W-L+1024)%1024],W++),N+=M}N=.125*N*R*v,m[_]=N>=1?32767:-1>=N?-32768:32767*N|0}return n}};window.jsfxr=function(a){W.A.B(a);var b=W.D();a=new Uint8Array(4*((b+1)/2|0)+44);var b=2*W.C(new Uint16Array(a.buffer,44),b),c=new Uint32Array(a.buffer,0,44);c[0]=1179011410,c[1]=b+36,c[2]=1163280727,c[3]=544501094,c[4]=16,c[5]=65537,c[6]=44100,c[7]=88200,c[8]=1048578,c[9]=1635017060,c[10]=b;for(var b=b+44,c=0,d="data:audio/wav;base64,";b>c;c+=3)var e=a[c]<<16|a[c+1]<<8|a[c+2],d=d+("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>18]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>12&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e>>6&63]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&e]);return d};var aa;!function(){function a(){this.sounds={}}a.prototype.add=function(a,b,c){this.sounds[a]=[],c.forEach(function(c,d){this.sounds[a].push({tick:0,count:b,pool:[]});for(var e=0;b>e;e++){var f=new Audio;f.src=jsfxr(c),this.sounds[a][d].pool.push(f)}},this)},a.prototype.play=function(a){var b=this.sounds[a],c=b.length>1?b[Math.floor(Math.random()*b.length)]:b[0];c.pool[c.tick].play(),c.tick<c.count-1?c.tick++:c.tick=0},aa=new a,aa.add("start",1,[[0,.2,.13,.01,,.3328,,,,,,,,.0994,,,,,1,,,.1,,.5]]),aa.add("right",5,[[3,1,.3197,.7823,.2124,.1117,,.091,,,,,,,,.3901,.1061,-.0873,1,,,,,.5]]),aa.add("pad",1,[[0,,.0945,,.1582,.4416,,-.535,,,,,,.3856,,,,,1,,,.0896,,.5]]),aa.add("boost",1,[[0,,.2833,,.1918,.4914,,.2408,,,,,,.0182,,,,,1,,,,,.5]]),aa.add("ring",1,[[0,,.0177,.565,.2893,.4147,,,,,,.4159,.6958,,,,,,1,,,,,.5]]),aa.add("bumper",1,[[0,,.2389,,.2437,.5057,,.164,,,,,,.1032,,,,,1,,,,,.5]]),aa.add("hurt",1,[[0,,.2056,,.2341,.2899,,.3315,,,,,,.1817,,.6354,,,1,,,,,.5]]),aa.add("eat",1,[[0,,.3402,,.2772,.4978,,.1736,,.2589,.3885,,,.1153,,,,,1,,,,,.5]]),aa.add("die",1,[[0,.98,.1686,,.3736,.487,,.0963,,,,,,.2066,,,,,1,,,,,.5]])}(),window.onload=function(){"use strict";function a(){function a(a,b,c,h){var i=4;T(Db,Vb,Ub,2),Db.beginPath(),Db.moveTo(a(-i),b(-i)),Db.lineTo(a(lb+mb),b(-i)),Db.lineTo(a(lb+mb),b(lb)),Db.arcTo(a(lb+mb),b(lb+mb),a(lb),b(lb+mb),mb),Db.lineTo(a(-i),b(lb+mb)),Db.closePath(),Db.fill(),Db.stroke(),B(C(a(lb),b(lb),mb,ac)),B(D(a(0),b(lb+mb),a(lb),b(lb+mb),ac)),B(D(a(lb+mb),b(0),a(lb+mb),b(lb),ac));var j=a==I?f:g;Db.font="64px sans-serif",Db.textAlign="center",Db.textBaseline="middle",T(Db,Yb[c][1]),Db.fillText(hb(j),a(lb+mb+130)-2,b(50)-3),T(Db,Yb[h][1]),j=b==I?d:e,Db.fillText(hb(j),a(50)-2,b(lb+mb+130)-3),Db.font="16px sans-serif",Db.textAlign="center",Db.textBaseline="middle",T(Db,Yb[c][1]),Db.fillText(lc[c],a(lb+mb+30),b(12)),T(Db,Yb[h][1]),Db.fillText(lc[h],a(16),b(lb+mb+12))}var b=R(yb,yb),c=S(b);U(c,0,0,yb,yb,Rb),U(c,0,0,yb-1,yb-1,Sb),U(c,0,0,yb-2,yb-2,Qb),U(Db,0,0,wb,wb,b),Db.globalAlpha=.1,U(Db,0,wb-lb-2,wb,lb,Yb[gc][1]),U(Db,wb-lb-2,0,lb,wb,Yb[hc][1]),U(Db,0,0,wb,lb,Yb[ic][1]),U(Db,0,0,lb,wb,Yb[jc][1]),Db.globalAlpha=1,Db.globalCompositeOperation="source-over",T(Db,Qb,Tb,2),X(Db,0,0,wb,wb),X(Db,wb,0,0,wb),W(Db,xb,xb,8,ib,ib);var d=8679,e=8681,f=8678,g=8680;a(I,I,2,3),a(I,J,0,3),a(J,I,2,1),a(J,J,0,1)}function b(){var a=Bb,b=a/2;Nb.save(),Nb.translate(4,4),T(Nb,"#aef","#5af",2),Nb.beginPath(),Nb.moveTo(b,0),Nb.quadraticCurveTo(a,-3,a,b),Nb.quadraticCurveTo(a,a+1,b,a-2),Nb.quadraticCurveTo(2,a,0,b),Nb.quadraticCurveTo(-3,-1,b,0),Nb.fill(),Nb.stroke(),T(Nb,jb,"#fff",2),X(Nb,8,4,4,20),X(Nb,16,2,8,26,0,1),X(Nb,36,14,18,36,0,1),X(Nb,38,18,26,36,0,2),T(Nb,jb,"#58f",2),X(Nb,b-4,10,b-4,18),X(Nb,b+4,10,b+4,18),Nb.translate(a+8,0),T(Nb,"#fa0","#f00",2),Nb.beginPath(),Nb.moveTo(b,-4),Nb.lineTo(b+6,14),Nb.lineTo(a-4,8),Nb.quadraticCurveTo(a,a+3,b,a-2),Nb.quadraticCurveTo(2,a,4,8),Nb.lineTo(b-6,14),Nb.lineTo(b,-4),Nb.fill(),Nb.stroke(),X(Nb,b-3,26,b-8,20),X(Nb,b+3,26,b+8,20),Nb.translate(a+8,0),T(Nb,"#fd7","#d72",2),Nb.beginPath(),Nb.moveTo(b,0),Nb.quadraticCurveTo(a,10,a-8,a-8),Nb.quadraticCurveTo(a,a+1,b+2,a-6),Nb.quadraticCurveTo(14,a-12,2,a-4),Nb.quadraticCurveTo(-2,a-10,4,b),Nb.quadraticCurveTo(0,0,b,0),Nb.fill(),Nb.stroke(),T(Nb,"#d72"),W(Nb,10,7,1,ib),W(Nb,24,9,1,ib),W(Nb,7,20,1,ib),W(Nb,20,14,1,ib),W(Nb,8,30,1,ib),W(Nb,28,32,1,ib),T(Nb,"#000","#d72",1);for(var c=0;2>c;c++){var d;0===c?(Nb.globalCompositeOperation="destination-out",d=ib):(Nb.globalCompositeOperation="source-over",d=jb),Nb.scale(1,1.5),W(Nb,13,14,4,d,ib),Nb.scale(1,2/3),Nb.scale(1,1.5),W(Nb,26,14,4,d,ib),Nb.scale(1,2/3)}Nb.translate(a+8,0),Nb.lineCap="round",T(Nb,0,"#fff",2),W(Nb,b,b,b-4,jb,ib),T(0,0,1),Nb.beginPath(),Nb.arc(b,b,b-8,3.2,4.4),Nb.stroke(),W(Nb,b-4,b+4,4,jb,ib),W(Nb,b+4,b+4,4,jb,ib),Nb.restore()}function c(){if(!Ob.width){var a=4;Ob.width=2*(Ec+a)*Fc,Ob.height=2*(Ec+a);for(var b=0;Fc>b;b++){var c=170+b/Fc*68>>0;c=c.toString(16),T(Pb,null,"#"+c+c+"00",3);var d=(2*b+1)*(a+Ec),e=a+Ec;Pb.beginPath(),Pb.arc(d,e,Ec,0,2*eb),Pb.stroke()}}}function d(){Pc=0,vc=0,uc=Date.now(),Mc=0,Kc=!1,tc=Hc,Bc=0,nc=[],oc=[],a(),b(),c(),y()}function e(){if(!Kc&&!Pc)if(cd.right||bd.space)Lc>Mc&&Mc++;else if(Mc>0){var a=.1+.9*Mc/Lc,b=Vc+Wc*a;Xc=b*db.cos(Oc),Yc=b*db.sin(Oc),Zc=Tc+Uc*a,Kc=!0,Ac="start",aa.play("boost")}for(var c=0;c<rc.length;c++){var d,e=rc[c],f=!e.mirror;d=1==e.elt?f?bd.up||bd.right:bd.down||bd.left:f?bd.up||bd.left:bd.down||bd.right;var g=e.ux,h=e.uy;e.cpt=e.cpt||0;var i=9;if(e.max=!1,d?e.cpt<i?e.cpt++:e.max=!0:e.cpt>0&&e.cpt--,e.prevX2=e.x2,e.prevY2=e.y2,e.movingUp=d&&!e.max,e.moving=0!==e.cpt,e.cpt>0){var j=e.amax*(e.cpt/i);e.mirror&&(j*=-1);var k=db.cos(j),l=db.sin(j);g=e.ux*k-e.uy*l,h=e.ux*l+e.uy*k}e._ux=g,e._uy=h,e.x2=e.x+g,e.y2=e.y+h}cd.left&&qc.elt!=kc&&0===Zc&&Bc>0&&(ad.x=cd.x-qc.x,ad.y=cd.y-qc.y,M(ad,Vc+.5*Wc),qc.v.x=ad.x,qc.v.y=ad.y,Zc=10,Xc=qc.v.x,Yc=qc.v.y,Ac="click",Bc-=10,cd.left=!1,aa.play("boost")),Bc>0&&Bc--}function f(){var a,b,c;for(b=sc.length,a=0;b>a;a++)c=sc[a],c.a+=c.da,c.x=xb+db.cos(c.a)*c.d,c.y=xb+db.sin(c.a)*c.d}function g(){var a,b,c,d,e;for(b=oc.length,a=0;b>a;a++){if(c=oc[a],c.elt!=qc.elt&&qc.elt!=kc){var f=L(qc.x-c.x,qc.y-c.y);200>f&&(c.elt==mc[qc.elt]?(c.tx=c.hx,c.ty=c.hy):(c.tx=qc.x,c.ty=qc.y))}if(d=c.tx-c.x,e=c.ty-c.y,25>d*d+e*e){var g=gb()*eb*2;c.tx=xb+db.cos(g)*vb,c.ty=xb+db.sin(g)*vb}else{var h=L(d,e);c.x+=d*Sc/h,c.y+=e*Sc/h}}}function h(){if(Kc){var a,b,c=0,d=0,e=Rc,f=Qc;a=xb-qc.x,b=xb-qc.y;var g=ob/2,h=L(a,b);g>h&&(a/=h,b/=h,e*=.2+.8*h/g,f*=.5+.5*h/g);var i=qc.x-xb,j=qc.y-xb;j>i?j>-i?d=e:c=-e:j>-i?c=e:d=-e,qc.v.x+=c,qc.v.y+=d,Zc>0&&(Zc--,qc.v.x+=Xc,qc.v.y+=Yc),qc.v.x*qc.v.x+qc.v.y*qc.v.y>f*f&&M(qc.v,f),qc.x+=qc.v.x,qc.y+=qc.v.y,qc.x=db.round(qc.x),qc.y=db.round(qc.y)}}function i(){var a,b,c,d;if(Kc){for(qc.collide=!1,d=nc.length,b=d+oc.length,a=0;b>a;a++){c=d>a?nc[a]:oc[a-d];var e=!1;if(c!=qc){c.collide=!1;var f=ad;c.shape==Zb?N(qc,c)&&(j(c,f),c.collide&&m(c,f)):c.shape==$b&&(e=c.kind==dc&&c.movingUp,e?l(c,f):O(qc,c,f)&&(k(c,f),c.collide&&m(c,f)))}}qc.prevX=qc.x,qc.prevY=qc.y}}function j(a,b){if(a.kind!=ec||(mc[qc.elt]!=a.elt||a.dead||(a.dead=!0,Bc=$c,vc++,aa.play("eat")),!a.dead)){a.collide=!0,b.x=qc.x-a.x,b.y=qc.y-a.y;var c=L(b.x,b.y);if(a.kind==bc&&qc.elt!=kc&&(Bc+=50,Bc>$c&&(Bc=$c),aa.play("bumper")),a.kind==ec&&a.elt!=qc.elt){if(zc=Ic,qc.elt=kc,pc.n<pc.length){pc.n++;var d=pc[pc.n-1];d.m=a,d.dx=b.x*(Cc-Ec)/c,d.dy=b.y*(Cc-Ec)/c,wc=Ic,xc=-1}aa.play("hurt")}b.l=a.r+qc.r-c,b.x=b.x/c,b.y=b.y/c}}function k(a,b){var c;a.collide=!0,P(_c,a.x,a.y,a.x2,a.y2);var d=Q(_c,qc.x,qc.y)!==Q(_c,qc.prevX,qc.prevY);0>=d?c=qc.r-b.l:(c=qc.r+b.l,b.x*=-1,b.y*=-1),b.x/=b.l,b.y/=b.l,b.l=c}function l(a,b){var c,d,e=O(qc,a,b),f=1==a.elt||3==a.elt;if(e||(P(_c,a.x,a.y,a.prevX2,a.prevY2),c=Q(_c,qc.prevX,qc.prevY,f),P(_c,a.x,a.y,a.x2,a.y2),d=Q(_c,qc.x,qc.y,f)),e||c!==d){var g=qc.x-a.x,h=qc.y-a.y,i=g*a._ux+h*a._uy;if((e||i>0)&&(e||g*g+h*h<a.l*a.l)){a.collide=!0;var j=(L(g,h),i/a.l);b.x=a.x+j*a._ux/a.l,b.y=a.y+j*a._uy/a.l,b.x=qc.x-b.x,b.y=qc.y-b.y,b.l=L(b.x,b.y),b.x/=b.l,b.y/=b.l;var k=a._uy/a.l,l=-a._ux/a.l;(a.mirror&&(0===a.elt||3==a.elt)||!a.mirror&&(1==a.elt||2==a.elt))&&(k*=-1,l*=-1);var m=k*b.x+l*b.y;0>m&&(b.x*=-1,b.y*=-1),b.l=b.l+qc.r,qc.x+=b.x*b.l,qc.y+=b.y*b.l,qc.collide=!0;var n=j/a.l;n=.1+.9*(.3*n+.7*n*n);var o=Tc+n*Uc>>0,p=Vc+Wc*n,q=b.x*p,r=b.y*p;Zc&&Ac==dc?(Zc=o,Xc=.2*q+Xc,Yc=.2*r+Yc):(aa.play("pad"),Zc=o,Xc=q,Yc=r),Ac=dc,Bc=$c,Xc*=.8+.4*gb(),Yc*=.8+.4*gb(),qc.elt=a.elt}}}function m(a,b){Zc=0,qc.collide=!0,a.colCpt=20,qc.x+=b.x*b.l,qc.y+=b.y*b.l;var c=L(qc.v.x,qc.v.y),d=qc.v.x/c,e=qc.v.y/c,f=-b.y,g=b.x,h=f*d+g*e;0>h&&(f=-f,g=-g);var i=d*b.x+e*b.y;0>i&&(i=-i);var j=db.sin(db.acos(i));0>j&&(j=-j);var k=.2;a.kind==bc?k=1.1:a.kind==ec&&(k=1.1),b.x*=i*k*c,b.y*=i*k*c,f*=j*c,g*=j*c,qc.v.x=b.x+f,qc.v.y=b.y+g}function n(){for(var a,b=(Dc+Ec)*(Dc+Ec),c=2*b,d=(Dc-Cc)*(Dc-Cc),e=oc.length,f=0;f<pc.n;f++){a=pc[f];var g=a.x-qc.x,h=a.y-qc.y,i=g*g+h*h;if(b>i)aa.play("ring"),a.m=null,pc[f]=pc[pc.n-1],pc[pc.n-1]=a,f--,pc.n--,wc=Ic,xc=1,0===pc.n&&(Jc=!0);else if(c>i&&(a.x=a.x-.3*g,a.y=a.y-.3*h),a.m)a.m.dead?a.m=null:(a.x=a.m.x+a.dx,a.y=a.m.y+a.dy);else for(var j=0;e>j;j++){var k=oc[j];g=a.x-k.x,h=a.y-k.y,i=g*g+h*h,d>i&&(a.m=k,a.dx=g,a.dy=h)}}}function o(){f(),g(),h(),i(),n()}function p(){tb=rb,ub=sb;var a=qc.x,b=qc.y,c=a-xb,d=b-xb,e=c,f=d;0>e&&(e*=-1),0>f&&(f*=-1);var g=kb/2+mb;if(g>e&&g>f){var h=e-g,i=f-g,j=h*h+i*i;if(g*g>j){var k=fb(j);h=h*g/k,i=i*g/k,a=h+g,b=i+g,0>c&&(a=-a),0>d&&(b=-b),a=xb+a,b=xb+b}}else f>e?a=xb:b=xb;a=K(a,qc.x-.3*ob,qc.x+.3*ob),b=K(b,qc.y-.3*pb,qc.y+.3*pb),a=K(a-ob/2,0,wb-ob),b=K(b-pb/2,0,wb-pb),Kc?(rb+=.1*(a-rb),sb+=.1*(b-sb)):(rb=a,sb=b)}function q(){var a=Kc;Y(Fb),Y(Jb);a?(V(Fb,Gb,0,0),Hb.clearRect(0,0,ob,pb),Hb.save(),Hb.globalAlpha=.9,V(Hb,Eb,-rb+tb,-sb+ub),Hb.restore(),Y(Fb),T(Hb,Yb[qc.elt][1]),Zc>0?W(Hb,qc.prevX-rb,qc.prevY-sb,6,ib):W(Hb,qc.x-rb,qc.y-sb,2,ib)):Y(Hb),r(),s(),t(),u(),V(Fb,Cb,-rb,-sb),a&&V(Fb,Gb,0,0),V(Fb,Ib,0,0)}function r(){for(var a,b,c=rb-Ec,d=rb+ob+Ec,e=sb-Ec,f=sb+ob+Ec,g=Ob.width/Fc,h=g/2,i=0,j=pc.n;j>i;i++){var k=pc[i];if(k.cpt+=k.cptDir,k.cpt>=Gc?(k.cpt=Gc,k.cptDir=-1):k.cpt<=0&&(k.cpt=0,k.cptDir=1),a=k.x,b=k.y,a>c&&d>a&&b>e&&f>b){var l=k.cpt/Gc*(Fc-1)>>0;Jb.drawImage(Ob,l*g,0,g,g,a-h-rb,b-h-sb,g,g)}}}function s(){for(var a=Bb+2*Ab,b=0,c=oc.length;c>b;b++){var d=oc[b],e=1;d.dead?(d.cpt-=10,d.cpt<=0?z(d):e=d.cpt/50):d.cpt<50&&(d.cpt++,e=d.cpt/50),d.colCpt>0&&d.colCpt--;var f=mc[qc.elt]==d.elt,g=qc.elt==d.elt;T(Jb,g?Vb:f?Yb[d.elt][0]:Xb,g?d.colCpt>0?Wb:Ub:Xb,2),Jb.globalAlpha=e*(g?.5:f?.2:.4),W(Jb,d.x-rb,d.y-sb,d.r,ib),d.elt==jc&&(Jb.globalAlpha=1,Jb.globalCompositeOperation="destination-out",W(Jb,d.x-rb,d.y-sb,17,ib),Jb.globalCompositeOperation="source-over"),Jb.globalAlpha=e,f||W(Jb,d.x-rb,d.y-sb,d.r,jb,ib),Jb.globalAlpha=e*(g?.4:f?.7:1);var h=0,i=0;f&&(h=3*(db.random()-.5),i=3*(db.random()-.5)),g&&(Jb.globalAlpha=.4*e),Jb.drawImage(Mb,d.elt*a,0,a,a,d.x-a/2-rb+h,d.y-a/2-sb+i,a,a)}Jb.globalAlpha=1}function t(){for(var a=0,b=nc.length;b>a;a++){var c,d=nc[a],e=d.x-rb,f=d.y-sb;d!=qc&&(d.shape==Zb&&d.kind==bc?(d.colCpt>0?(d.colCpt--,c=Wb):c=Ub,T(Jb,"#000",c,2),W(Jb,e,f,d.r,ib,ib)):d.shape==$b&&d.kind!=ac&&(c=Ub,d.kind==dc&&(c=Yb[d.elt][1]),T(Jb,0,c,2),X(Jb,d.x-rb,d.y-sb,d.x2-rb,d.y2-sb)))}}function u(){if(!Pc){var a;Kc?(a=db.atan2(qc.v.y,qc.v.x),Nc=0):(a=qc.sa,Nc+=.05),qc.cpt=++qc.cpt%20;var b=qc.cpt;b>10&&(b=20-b),Kc||(b=2+8*(Mc/Lc),a+=db.cos(Nc)*eb/3,Oc=a),b*=.3*eb/10;var c=0,d=0;if(Mc>0&&!Kc){var e=4*K(Mc/Lc,0,1);c=e*gb(),d=e*gb()}qc.elt!=kc&&Bc>0&&(Jb.save(),Jb.translate(qc.x-rb+c,qc.y-sb+d),Jb.rotate(a),T(Jb,"#fff","#000",1),Jb.beginPath(),Jb.arc(-10,0,20,0,2.2),Jb.lineTo(0,0),Jb.arc(-10,0,20,-0,-2.2,!0),Jb.lineTo(0,0),Jb.closePath(),Jb.fill(),Jb.stroke(),Jb.globalCompositeOperation="destination-out",W(Jb,0,0,Dc,"#fff"),Jb.restore()),zc>0?T(Jb,Yb[qc.elt][0],Xb,3):T(Jb,Yb[qc.elt][0],Yb[qc.elt][1],2),0===b?W(Jb,qc.x-rb+c,qc.y-sb+d,Dc,ib,ib):Z(Jb,qc.x-rb+c,qc.y-sb+d,qc.r,a,b,ib,ib)}}function v(){var a=!1;qc.x+Dc<0?(a=!0,qc.x=50,qc.y=xb,qc.sa=0):qc.x-Dc>wb?(a=!0,qc.x=wb-50,qc.y=xb,qc.sa=-eb):qc.y+Dc<0?(a=!0,qc.y=50,qc.x=xb,qc.sa=eb/2):qc.y-Dc>wb&&(a=!0,qc.y=wb-50,qc.x=xb,qc.sa=-eb/2),a&&(Kc=!1,Mc=0,qc.elt=kc,qc.v.x=0,qc.v.y=0,yc=Ic,Pc=Lc,tc--,0===tc&&(Jc=!0)),Pc>0&&Pc--}function w(){Y(Lb);var a,b=9,c=14;for(a=0;tc>a;a++)T(Lb,Yb[kc][0],"red"),Z(Lb,50+zb/2+a*(b+c),zb/2,b,0,.3,!0);if(zc>0&&zc--,Kc&&!Jc){var d=20,e=102,f=(ob-e)/2,g=(zb-d)/2;T(Lb,Sb),U(Lb,f,g,e,d),zc&&(T(Lb,"#f00"),Lb.globalAlpha=zc/Lc,U(Lb,f-2,g-2,e+4,d+4),Lb.globalAlpha=1),Bc>0&&qc.elt!=kc&&(T(Lb,"#fff"),e=(e-2)*(Bc/$c)>>0,f=(ob-e)/2+1,U(Lb,f,g,e,d),T(Lb,0,Sb,2),Lb.save(),Lb.translate(ob/2,g+10),Lb.rotate(-eb/2),Lb.beginPath(),Lb.arc(-10,0,18,-0,-1.4,!0),Lb.lineTo(0,0),Lb.closePath(),Lb.stroke(),Lb.beginPath(),Lb.arc(-10,0,18,0,1.4),Lb.lineTo(0,0),Lb.closePath(),Lb.stroke(),Lb.restore())}T(Lb,0,"#cc0",3),W(Lb,ob-20,zb/2,8,!1,!0);var h=(Date.now()-uc)/1e3>>0,i=h/60>>0,j=h%60;10>j&&(j="0"+j),h=i+":"+j,T(Lb,"#fff"),Lb.font="18px sans-serif",Lb.textAlign="left",Lb.textBaseline="middle",Lb.fillText(h,10,zb/2);var k;(!Kc||Jc)&&(Lb.textAlign="center",k=Jc?"Game over":Pc?"Out...":50>Mc?"Hold right mouse button":"Release to launch !",Lb.fillText(k,ob/2,zb/2));var l=pc.length-pc.n,m=l+" / "+pc.length;if(wc>0&&(wc--,xc>0?(T(Lb,"#0f0"),m=hb(8593)+" "+m):(T(Lb,"#f00"),m=hb(8595)+" "+m)),Lb.textAlign="right",Lb.fillText(m,ob-38,zb/2),yc>0&&yc--,Jc){var n=tc>0,o=[],p=0,q=1e4,r=100,s=200,t=1e3,u=0;if(o[p++]=n?{t:"YOU WIN :)",s:32,c:"#0f4"}:{t:"YOU LOSE :(",s:32,c:"#f04"},o[p++]={s:24},n?(u+=q,o[p++]={t1:"Finished game:",t2:q,s:18,c:"#ccc"},u+=t*tc,o[p++]={t1:"Extra balls:",t2:tc+" x "+t,s:18,c:"#ccc"}):(u+=r*l,o[p++]={t1:"Rings:",t2:l+" x "+r,s:18,c:"#ccc"}),u+=vc*s,o[p++]={t1:"Eaten monsters:",t2:vc+" x "+s,s:18,c:"#ccc"},h=(Date.now()-uc)/1e3>>0,h=20*(300-h)*l/pc.length>>0,0>h&&(h=0),u+=h,o[p++]={t1:"Time bonus:",t2:h,s:18,c:"#ccc"},o[p++]={t1:"Score:",t2:u,s:24,c:"#fff"},localStorage){var v=parseInt(localStorage.getItem("pacBallScoreMax"));(!v||u>v)&&localStorage.setItem("pacBallScoreMax",u),v&&(u>v?(o[p++]={s:24},o[p++]={t:"New Record !",s:24,c:"#fff"}):o[p++]={t1:"( Record:",t2:v+" )",s:18,c:"#ccc"})}for(o[p++]={s:48},o[p++]={t:"Press SPACE to restart",s:24,c:"#fff"},o[p++]={s:48},c=10,b=2*c,a=0;p>a;a++)b+=o[a].s+4;o.c="#fff";var w=kb/2-10,x=b;for(Fb.save(),Fb.translate((ob-w)/2>>0,(pb-x)/2>>0),T(Fb,"#000","#fff"),Fb.fillRect(0,0,w,x),Fb.strokeRect(0,0,w,x),Fb.textBaseline="top",a=0;p>a;a++)k=o[a],Fb.font=k.s+"px sans-serif",Fb.fillStyle=k.c,k.t?(Fb.textAlign="center",Fb.fillText(k.t,w/2,c)):k.t1&&(Fb.textAlign="right",Fb.fillText(k.t1,w/2-4,c),Fb.textAlign="left",Fb.fillText(k.t2,w/2+4,c)),Fb.translate(0,k.s+c);Fb.restore()}}function x(){window.stb&&stb(),Jc?bd.space&&(Jc=!1,d(),bd.space=!1):(e(),o(),v(),p(),q(),w()),window.ste&&ste(),requestAnimationFrame(x)}function y(){qc=B(C(xb,wb-50,Dc,_b)),qc.v={x:0,y:0},qc.cpt=0,qc.elt=kc,qc.sa=-eb/2,F(D(0,220,150,100,cc)),sc=[];var a,b,c,d=4;for(b=0;d>b;b++){var e=Cc-4,f=2*e+(nb-2*e)*b/d,g=2*gb()*eb;a=C(0,0,e,bc),sc.push(B(a));var h=(.2+.2*gb())*(gb()>.5?-1:1);a.da=h/f,a.a=g,a.d=f}for(b=1;d>b;b++)for(c=0;b>c;c++)a=H(sc[b]),a.a+=2*eb*(c+1)/(b+1),sc.push(B(a));F(D(150,100,300,30,dc)),rc=nc.slice(-8);var i=rc[0],j=L(i.x-i.x2,i.y-i.y2),k=2*-db.acos((i.x2-i.x)/j);for(b=0;b<rc.length;b++)i=rc[b],i.l=j,i.ux=i.x2-i.x,i.uy=i.y2-i.y,i.amax=k,(1==i.elt||2==i.elt)&&(i.amax*=-1);pc=[],pc.n=0,pc.cpt=0;var l,m,n=6,o=11,p=db.random()*eb;for(b=1;n>=b;b++)for(c=1;o>=c;c++)m=2*eb*(c/o)+.1*b+p,l=A(Zb,fc),l.r=Ec,l.cpt=gb()*Gc>>0,l.cptDir=gb()>.5?1:-1,pc[pc.n]=l,pc.n++,l.x=xb+db.cos(m)*b*vb/n,l.y=xb+db.sin(m)*b*vb/n;for(b=0;4>b;b++){var q=A(Zb,ec);oc.push(q),q.elt=b,q.r=Cc,q.sy=0===b||1==b?lb:wb-lb,q.sx=0===b||3==b?lb:wb-lb,q.hx=xb+.5*kb*(1==b?1:3==b?-1:0),q.hy=xb+.5*kb*(0===b?1:2==b?-1:0),z(q)}}function z(a){a.tx=a.hx,a.ty=a.hy,a.x=a.sx,a.y=a.sy,a.cpt=0,a.dead=!1,a.da=0,a.a=0,a.d=1}function A(a,b,c,d){return{x:c||0,y:d||0,shape:a,kind:b}}function B(a){return nc.push(a),a}function C(a,b,c,d){var e=A(Zb,d,a,b);return e.r=c,e}function D(a,b,c,d,e){var f=A($b,e,a,b);return f.x2=c,f.y2=d,f}function E(a){for(var b=0;4>b;b++){var c=H(a);G(c,"x","y",b),c.shape==$b&&G(c,"x2","y2",b),B(c),c.elt=b}}function F(a){E(a),a.x=kb-a.x,a.shape==$b&&(a.x2=kb-a.x2),a.mirror=!0,E(a)}function G(a,b,c,d){var e=a[b],f=a[c];if(0===d||2==d)e+=lb+mb,0===d&&(f=wb-f);else{var g=f;f=lb+mb+e,e=g,1==d&&(e=wb-e)}a[b]=e,a[c]=f}function H(a){return JSON.parse(JSON.stringify(a))}function I(a){return a}function J(a){return wb-a}function K(a,b,c){return b>a?b:a>c?c:a}function L(a,b){return fb(a*a+b*b)}function M(a,b){b=(b||1)/L(a.x,a.y),a.x*=b,a.y*=b}function N(a,b){var c=a.x-b.x,d=a.y-b.y,e=a.r+b.r;return e*e>c*c+d*d}function O(a,b,c){var d=a.x,e=a.y,f=a.r,g=b.x,h=b.y,i=b.x2,j=b.y2,k=i-g,l=j-h,m=db.sqrt(k*k+l*l),n=(i-g)/m,o=(j-h)/m,p=n*(d-g)+o*(e-h),q=p*n+g,r=p*o+h;if((i>g&&q>=g&&i>=q||g>i&&q>=i&&g>=q||g==i&&q==g)&&(j>h&&r>=h&&j>=r||h>j&&r>=j&&h>=r||h==j&&r==h)){var s=r-e,t=q-d,u=fb(t*t+s*s);if(f>=u)return c.ex=q,c.ey=r,c.x=-t,c.y=-s,c.l=u,!0}return!1}function P(a,b,c,d,e){b==d?(a.vert=!0,a.x=b):(a.vert=!1,a.m=(c-e)/(b-d),a.p=c-a.m*b)}function Q(a,b,c,d){return a.vert?b<a.x:d?b>(c-a.p)/a.m:c>a.m*b+a.p}function R(a,b){var c=bb.createElement("canvas");return c.width=a,c.height=b,c}function S(a){return a.getContext("2d")}function T(a,b,c,d){b&&(a.fillStyle=b),c&&(a.strokeStyle=c),d&&(a.lineWidth=d)}function U(a,b,c,d,e,f){f&&(f.width&&(f=a.createPattern(f,"repeat")),T(a,f)),a.fillRect(b,c,d,e)}function V(a,b,c,d){a.drawImage(b,c,d)}function W(a,b,c,d,e,f){a.beginPath(),a.arc(b,c,d,0,2*eb,!1),e&&a.fill(),f&&a.stroke()}function X(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.stroke()}function Y(a){a.clearRect(0,0,ob,pb)}function Z(a,b,c,d,e,f,g,h){a.beginPath(),a.arc(b,c,d,e+f,e-f),a.lineTo(b,c),a.closePath(),g&&a.fill(),h&&a.stroke()}function $(a,b){b||(b=window.e);var c=b.keyCode;b.charCode&&!c&&(c=b.charCode),bd[dd[c]]=a}function _(a,b){var c,d;"which"in b?(c=3==b.which,d=2==b.which):"button"in b&&(c=2==b.button,d=1==b.button),c?cd.right=a:d?cd.middle=a:cd.left=a,bb.onmousemove(b)}var ab=window,bb=ab.document,cb=bb.body,db=ab.Math,eb=db.PI,fb=db.sqrt,gb=db.random,hb=String.fromCharCode,ib=!0,jb=!1,kb=700,lb=220,mb=200,nb=mb+kb/2;nb=L(nb,nb)-mb>>0;var ob,pb,qb,rb,sb,tb,ub,vb=(kb/2+L(kb/2,kb/2))/2,wb=kb+2*lb+2*mb,xb=wb/2,yb=20,zb=50,Ab=4,Bb=40,Cb=R(wb,wb),Db=S(Cb),Eb=R(),Fb=S(Eb),Gb=R(),Hb=S(Gb),Ib=R(),Jb=S(Ib),Kb=R(),Lb=S(Kb),Mb=R(4*(Bb+2*Ab),Bb+2*Ab),Nb=S(Mb),Ob=R(),Pb=S(Ob);window.onresize=function(){ob=K(ab.innerWidth,kb,wb),pb=K(ab.innerHeight-zb,kb,wb),qb=db.min(ob,pb),Kb.width=Ib.width=Gb.width=Eb.width=ob-=ob%2,Ib.height=Gb.height=Eb.height=pb-=pb%2,Kb.height=zb},cb.onresize(),cb.appendChild(Kb),cb.appendChild(Eb);var Qb="#111",Rb="#222",Sb="#333",Tb="#444",Ub="#08e",Vb="#000",Wb="#8f8",Xb="#f02",Yb=[["#aef","#5af"],["#fa0","#f53"],["#a64","#864","#fd7"],["rgba(255,255,255,0.5","#fff","#fff"],["#ff6","#555"]],Zb="c",$b="l",_b="b",ac="bg",bc="bp",cc="o",dc="p",ec="m",fc="ring",gc=0,hc=1,ic=2,jc=3,kc=4,lc=["Water","Fire","Earth","Air"],mc={};mc[gc]=hc,mc[hc]=gc,mc[ic]=jc,mc[jc]=ic;var nc,oc,pc,qc,rc,sc,tc,uc,vc,wc,xc,yc,zc,Ac,Bc,Cc=38,Dc=16,Ec=8,Fc=10,Gc=30,Hc=5,Ic=50,Jc=!1,Kc=!1,Lc=100,Mc=0,Nc=0,Oc=0,Pc=0,Qc=10,Rc=.2,Sc=1,Tc=1,Uc=12,Vc=.2*Qc,Wc=.8*Qc,Xc=0,Yc=0,Zc=0,$c=150,_c={},ad={},bd={},cd={};d(),x();var dd={37:"left",65:"left",81:"left",38:"up",90:"up",87:"up",83:"down",40:"down",39:"right",68:"right",32:"space",27:"esc",13:"Enter"};bb.onkeyup=function(a){$(!1,a),27==a.keyCode&&(window._stopped?(window._stopped=!1,window.requestAnimationFrame=window._raf):(window._stopped=!0,window._raf=window.requestAnimationFrame,window.requestAnimationFrame=function(){})),13==a.keyCode&&window._stopped&&x()},bb.onkeydown=function(a){$(!0,a)},bb.onmousedown=function(a){_(!0,a)},bb.onmouseup=function(a){_(!1,a)},bb.onmousemove=function(a){cd.x=a.clientX+rb,cd.y=a.clientY+sb-zb},bb.oncontextmenu=function(){return!1}};